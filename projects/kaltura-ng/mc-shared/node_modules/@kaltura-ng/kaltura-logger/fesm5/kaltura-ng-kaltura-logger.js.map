{"version":3,"file":"kaltura-ng-kaltura-logger.js","sources":["ng://@kaltura-ng/kaltura-logger/lib/kaltura-logger-record.service.ts","ng://@kaltura-ng/kaltura-logger/lib/kaltura-logger.service.ts","ng://@kaltura-ng/kaltura-logger/lib/kaltura-logger.module.ts","ng://@kaltura-ng/kaltura-logger/public_api.ts","ng://@kaltura-ng/kaltura-logger/kaltura-ng-kaltura-logger.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class KalturaLoggerRecordService {\n  private _recordLogs = false;\n  private _logsBuffer: any[] = [];\n  \n  \n  public get isRecordingLogs(): boolean {\n    return this._recordLogs;\n  }\n  \n  public startRecord(): void {\n    this._recordLogs = true;\n  }\n  \n  public getRecordedLogs(): any[] {\n    const result = [...this._logsBuffer];\n    this._recordLogs = false;\n    this._logsBuffer = [];\n    return result;\n  }\n  \n  public addLogItemToBuffer(logItem: any): void {\n    if (this.isRecordingLogs) {\n      this._logsBuffer.push(logItem);\n    }\n  }\n}","import { Injectable, SkipSelf, Optional, Self, Inject, Provider, OnDestroy } from '@angular/core';\nimport { JL } from 'jsnlog';\nimport { InjectionToken } from '@angular/core';\nimport { KalturaLoggerRecordService } from './kaltura-logger-record.service';\n\nexport const KalturaLoggerName = new InjectionToken<string>('kaltura-logger-name');\n\nexport type Context = { [key: string]: any };\nexport type DefferedContext = () => Context;\nexport type LogLevels = 'All' | 'Trace' | 'Debug' | 'Info' | 'Warn' | 'Error' | 'Fatal' | 'Off';\n\nlet randomLoggerNameNumber = 1;\n\n@Injectable()\nexport class KalturaLogger implements OnDestroy {\n  static resetDefaultExecuted = false;\n\n  static resetDefaultJSNLog() {\n    if (!KalturaLogger.resetDefaultExecuted) {\n      KalturaLogger.resetDefaultExecuted = true;\n      const consoleAppender = JL.createConsoleAppender('consoleAppender');\n\n      JL().setOptions({\n        appenders: [consoleAppender]\n      });\n    }\n  }\n\n\n  static createLogger(loggerName: string): Provider[] {\n    return [\n      KalturaLogger,\n      {\n        provide: KalturaLoggerName, useValue: loggerName\n      }\n    ];\n  }\n\n\n  private _name: string;\n  private _logger: JL.JSNLogLogger;\n\n  public get name(): string {\n    return this._name;\n  }\n\n\n  constructor(@Inject(KalturaLoggerName) @Optional() @Self() name: string,\n              @SkipSelf() @Optional() parentLogger: KalturaLogger,\n              @Optional() private _loggerRecordInterceptor: KalturaLoggerRecordService) {\n\n    KalturaLogger.resetDefaultJSNLog();\n\n    if (!name) {\n      name = 'logger' + randomLoggerNameNumber;\n      randomLoggerNameNumber++;\n    }\n\n    name = name.replace(/[.]/g, '_');\n\n    this._name = parentLogger ? `${parentLogger.name}.${name}` : name;\n    this._logger = JL(this._name);\n    this._logger.trace('logger created!');\n  }\n\n  private _addLogToBuffer(logItem: any): void {\n    if (this._loggerRecordInterceptor) {\n      this._loggerRecordInterceptor.addLogItemToBuffer(logItem);\n    }\n  }\n\n  public startRecordingLogs(): void {\n    if (this._loggerRecordInterceptor) {\n      this._loggerRecordInterceptor.startRecord();\n    }\n  }\n\n  public getRecordedLogs(): any[] | void {\n    if (this._loggerRecordInterceptor) {\n      return this._loggerRecordInterceptor.getRecordedLogs();\n    }\n  }\n\n  public isValidLogLevel(level: LogLevels): boolean {\n    const validLogLevels = ['All', 'Trace', 'Debug', 'Info', 'Warn', 'Error', 'Fatal', 'Off'];\n    return validLogLevels.indexOf(level) !== -1;\n  }\n\n  public setOptions(options: { level?: LogLevels }): void {\n    let level: number = undefined;\n    if (this.isValidLogLevel(options.level) && JL) {\n      const getLevelValue = JL[`get${options.level}Level`];\n      level = typeof getLevelValue === 'function' ? getLevelValue() : undefined;\n    }\n\n    JL().setOptions({level: level});\n  }\n\n  public subLogger(name: string): KalturaLogger {\n    return new KalturaLogger(name, this, this._loggerRecordInterceptor);\n  }\n\n  ngOnDestroy() {\n    this._logger.debug('logger destroyed');\n    delete this._logger;\n\n  }\n\n  private _createLogObject(level: string, message: string, context: Context | Error): any {\n    this._addLogToBuffer({level, message, context});\n    return context ? Object.assign({message, level}, context) : message;\n  }\n\n  public trace(message: string, context?: Context): void;\n  public trace(message: string, context?: DefferedContext): void;\n  public trace(message: string, context?: Context | DefferedContext): void {\n    if (context && typeof context === 'function') {\n      this._logger.trace(() => this._createLogObject('trace', message, (<Function>context)()));\n    } else {\n      this._logger.trace(this._createLogObject('trace', message, <Context>context));\n    }\n  }\n\n  public debug(message: string, context?: Context): void;\n  public debug(message: string, context?: DefferedContext): void;\n  public debug(message: string, context?: Context | DefferedContext): void {\n    if (context && typeof context === 'function') {\n      this._logger.debug(() => this._createLogObject('debug', message, (<Function>context)()));\n    } else {\n      this._logger.debug(this._createLogObject('debug', message, <Context>context));\n    }\n  }\n\n  public info(message: string, context?: Context): void;\n  public info(message: string, context?: DefferedContext): void;\n  public info(message: string, context?: Context | DefferedContext): void {\n    if (context && typeof context === 'function') {\n      this._logger.info(() => this._createLogObject('info', message, (<Function>context)()));\n    } else {\n      this._logger.info(this._createLogObject('info', message, <Context>context));\n    }\n  }\n\n  public warn(message: string, context?: Context): void;\n  public warn(message: string, context?: DefferedContext): void;\n  public warn(message: string, context?: Context | DefferedContext): void {\n    if (context && typeof context === 'function') {\n      this._logger.warn(() => this._createLogObject('warn', message, (<Function>context)()));\n    } else {\n      this._logger.warn(this._createLogObject('warn', message, <Context>context));\n    }\n  }\n\n  public error(message: string, context?: Context): void;\n  public error(message: string, error?: Error): void;\n  public error(message: string, context?: Error | Context): void {\n    this._logger.error(this._createLogObject('error', message, context));\n  }\n\n  public fatal(message: string, context?: Context): void;\n  public fatal(message: string, error?: Error): void;\n  public fatal(message: string, context?: Error | Context): void {\n    if (context && context instanceof Error) {\n      this._logger.fatalException(message, context);\n    } else {\n      this._logger.fatal(this._createLogObject('fatal', message, context));\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders, Optional, SkipSelf } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { KalturaLogger, KalturaLoggerName } from './kaltura-logger.service';\nimport { JL } from 'jsnlog';\nimport { KalturaLoggerRecordService } from './kaltura-logger-record.service';\n\nif (window && window.onerror) {\n    window.onerror = null;\n}\n\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [\n\n    ],\n    exports: [\n    ],\n    providers: [\n    ]\n})\nexport class KalturaLoggerModule {\n\n\n    static forRoot(name: string): ModuleWithProviders {\n        return {\n          ngModule: KalturaLoggerModule,\n          providers: [\n\t          KalturaLogger,\n\t          {\n\t\t          provide: KalturaLoggerName, useValue: name\n\t          },\n            KalturaLoggerRecordService\n          ]\n        }\n    }\n}\n\n","/*\n * Public API Surface of kaltura-logger\n */\n\nexport * from './lib/kaltura-logger.module';\nexport * from './lib/kaltura-logger.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n\nexport {KalturaLoggerRecordService as Éµa} from './lib/kaltura-logger-record.service';"],"names":[],"mappings":"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"}