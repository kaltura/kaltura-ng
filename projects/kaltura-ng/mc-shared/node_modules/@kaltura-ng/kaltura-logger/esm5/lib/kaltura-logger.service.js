import { __decorate, __metadata, __param } from "tslib";
import { Injectable, SkipSelf, Optional, Self, Inject } from '@angular/core';
import { JL } from 'jsnlog';
import { InjectionToken } from '@angular/core';
import { KalturaLoggerRecordService } from './kaltura-logger-record.service';
export var KalturaLoggerName = new InjectionToken('kaltura-logger-name');
var randomLoggerNameNumber = 1;
var KalturaLogger = /** @class */ (function () {
    function KalturaLogger(name, parentLogger, _loggerRecordInterceptor) {
        this._loggerRecordInterceptor = _loggerRecordInterceptor;
        KalturaLogger_1.resetDefaultJSNLog();
        if (!name) {
            name = 'logger' + randomLoggerNameNumber;
            randomLoggerNameNumber++;
        }
        name = name.replace(/[.]/g, '_');
        this._name = parentLogger ? parentLogger.name + "." + name : name;
        this._logger = JL(this._name);
        this._logger.trace('logger created!');
    }
    KalturaLogger_1 = KalturaLogger;
    KalturaLogger.resetDefaultJSNLog = function () {
        if (!KalturaLogger_1.resetDefaultExecuted) {
            KalturaLogger_1.resetDefaultExecuted = true;
            var consoleAppender = JL.createConsoleAppender('consoleAppender');
            JL().setOptions({
                appenders: [consoleAppender]
            });
        }
    };
    KalturaLogger.createLogger = function (loggerName) {
        return [
            KalturaLogger_1,
            {
                provide: KalturaLoggerName, useValue: loggerName
            }
        ];
    };
    Object.defineProperty(KalturaLogger.prototype, "name", {
        get: function () {
            return this._name;
        },
        enumerable: true,
        configurable: true
    });
    KalturaLogger.prototype._addLogToBuffer = function (logItem) {
        if (this._loggerRecordInterceptor) {
            this._loggerRecordInterceptor.addLogItemToBuffer(logItem);
        }
    };
    KalturaLogger.prototype.startRecordingLogs = function () {
        if (this._loggerRecordInterceptor) {
            this._loggerRecordInterceptor.startRecord();
        }
    };
    KalturaLogger.prototype.getRecordedLogs = function () {
        if (this._loggerRecordInterceptor) {
            return this._loggerRecordInterceptor.getRecordedLogs();
        }
    };
    KalturaLogger.prototype.isValidLogLevel = function (level) {
        var validLogLevels = ['All', 'Trace', 'Debug', 'Info', 'Warn', 'Error', 'Fatal', 'Off'];
        return validLogLevels.indexOf(level) !== -1;
    };
    KalturaLogger.prototype.setOptions = function (options) {
        var level = undefined;
        if (this.isValidLogLevel(options.level) && JL) {
            var getLevelValue = JL["get" + options.level + "Level"];
            level = typeof getLevelValue === 'function' ? getLevelValue() : undefined;
        }
        JL().setOptions({ level: level });
    };
    KalturaLogger.prototype.subLogger = function (name) {
        return new KalturaLogger_1(name, this, this._loggerRecordInterceptor);
    };
    KalturaLogger.prototype.ngOnDestroy = function () {
        this._logger.debug('logger destroyed');
        delete this._logger;
    };
    KalturaLogger.prototype._createLogObject = function (level, message, context) {
        this._addLogToBuffer({ level: level, message: message, context: context });
        return context ? Object.assign({ message: message, level: level }, context) : message;
    };
    KalturaLogger.prototype.trace = function (message, context) {
        var _this = this;
        if (context && typeof context === 'function') {
            this._logger.trace(function () { return _this._createLogObject('trace', message, context()); });
        }
        else {
            this._logger.trace(this._createLogObject('trace', message, context));
        }
    };
    KalturaLogger.prototype.debug = function (message, context) {
        var _this = this;
        if (context && typeof context === 'function') {
            this._logger.debug(function () { return _this._createLogObject('debug', message, context()); });
        }
        else {
            this._logger.debug(this._createLogObject('debug', message, context));
        }
    };
    KalturaLogger.prototype.info = function (message, context) {
        var _this = this;
        if (context && typeof context === 'function') {
            this._logger.info(function () { return _this._createLogObject('info', message, context()); });
        }
        else {
            this._logger.info(this._createLogObject('info', message, context));
        }
    };
    KalturaLogger.prototype.warn = function (message, context) {
        var _this = this;
        if (context && typeof context === 'function') {
            this._logger.warn(function () { return _this._createLogObject('warn', message, context()); });
        }
        else {
            this._logger.warn(this._createLogObject('warn', message, context));
        }
    };
    KalturaLogger.prototype.error = function (message, context) {
        this._logger.error(this._createLogObject('error', message, context));
    };
    KalturaLogger.prototype.fatal = function (message, context) {
        if (context && context instanceof Error) {
            this._logger.fatalException(message, context);
        }
        else {
            this._logger.fatal(this._createLogObject('fatal', message, context));
        }
    };
    var KalturaLogger_1;
    KalturaLogger.resetDefaultExecuted = false;
    KalturaLogger.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Inject, args: [KalturaLoggerName,] }, { type: Optional }, { type: Self }] },
        { type: KalturaLogger, decorators: [{ type: SkipSelf }, { type: Optional }] },
        { type: KalturaLoggerRecordService, decorators: [{ type: Optional }] }
    ]; };
    KalturaLogger = KalturaLogger_1 = __decorate([
        Injectable(),
        __param(0, Inject(KalturaLoggerName)), __param(0, Optional()), __param(0, Self()),
        __param(1, SkipSelf()), __param(1, Optional()),
        __param(2, Optional()),
        __metadata("design:paramtypes", [String, KalturaLogger,
            KalturaLoggerRecordService])
    ], KalturaLogger);
    return KalturaLogger;
}());
export { KalturaLogger };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FsdHVyYS1sb2dnZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BrYWx0dXJhLW5nL2thbHR1cmEtbG9nZ2VyLyIsInNvdXJjZXMiOlsibGliL2thbHR1cmEtbG9nZ2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUF1QixNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0MsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFFN0UsTUFBTSxDQUFDLElBQU0saUJBQWlCLEdBQUcsSUFBSSxjQUFjLENBQVMscUJBQXFCLENBQUMsQ0FBQztBQU1uRixJQUFJLHNCQUFzQixHQUFHLENBQUMsQ0FBQztBQUcvQjtJQWlDRSx1QkFBMkQsSUFBWSxFQUNuQyxZQUEyQixFQUMvQix3QkFBb0Q7UUFBcEQsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUE0QjtRQUVsRixlQUFhLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUVuQyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1QsSUFBSSxHQUFHLFFBQVEsR0FBRyxzQkFBc0IsQ0FBQztZQUN6QyxzQkFBc0IsRUFBRSxDQUFDO1NBQzFCO1FBRUQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRWpDLElBQUksQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBSSxZQUFZLENBQUMsSUFBSSxTQUFJLElBQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ2xFLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QixJ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WUFDTCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQ3RFO0lBQ0gsQ0FBQzs7SUF4Sk0sa0NBQW9CLEdBQUcsS0FBSyxDQUFDOzs2Q0FnQ3ZCLE1BQU0sU0FBQyxpQkFBaUIsY0FBRyxRQUFRLFlBQUksSUFBSTtnQkFDTixhQUFhLHVCQUFsRCxRQUFRLFlBQUksUUFBUTtnQkFDeUIsMEJBQTBCLHVCQUF2RSxRQUFROztJQW5DVixhQUFhO1FBRHpCLFVBQVUsRUFBRTtRQWtDRSxXQUFBLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBLEVBQUUsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsSUFBSSxFQUFFLENBQUE7UUFDN0MsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsUUFBUSxFQUFFLENBQUE7UUFDdEIsV0FBQSxRQUFRLEVBQUUsQ0FBQTtpREFEMkIsYUFBYTtZQUNMLDBCQUEwQjtPQW5DekUsYUFBYSxDQTBKekI7SUFBRCxvQkFBQztDQUFBLEFBMUpELElBMEpDO1NBMUpZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBTa2lwU2VsZiwgT3B0aW9uYWwsIFNlbGYsIEluamVjdCwgUHJvdmlkZXIsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSkwgfSBmcm9tICdqc25sb2cnO1xuaW1wb3J0IHsgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEthbHR1cmFMb2dnZXJSZWNvcmRTZXJ2aWNlIH0gZnJvbSAnLi9rYWx0dXJhLWxvZ2dlci1yZWNvcmQuc2VydmljZSc7XG5cbmV4cG9ydCBjb25zdCBLYWx0dXJhTG9nZ2VyTmFtZSA9IG5ldyBJbmplY3Rpb25Ub2tlbjxzdHJpbmc+KCdrYWx0dXJhLWxvZ2dlci1uYW1lJyk7XG5cbmV4cG9ydCB0eXBlIENvbnRleHQgPSB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xuZXhwb3J0IHR5cGUgRGVmZmVyZWRDb250ZXh0ID0gKCkgPT4gQ29udGV4dDtcbmV4cG9ydCB0eXBlIExvZ0xldmVscyA9ICdBbGwnIHwgJ1RyYWNlJyB8ICdEZWJ1ZycgfCAnSW5mbycgfCAnV2FybicgfCAnRXJyb3InIHwgJ0ZhdGFsJyB8ICdPZmYnO1xuXG5sZXQgcmFuZG9tTG9nZ2VyTmFtZU51bWJlciA9IDE7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBLYWx0dXJhTG9nZ2VyIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgc3RhdGljIHJlc2V0RGVmYXVsdEV4ZWN1dGVkID0gZmFsc2U7XG5cbiAgc3RhdGljIHJlc2V0RGVmYXVsdEpTTkxvZygpIHtcbiAgICBpZiAoIUthbHR1cmFMb2dnZXIucmVzZXREZWZhdWx0RXhlY3V0ZWQpIHtcbiAgICAgIEthbHR1cmFMb2dnZXIucmVzZXREZWZhdWx0RXhlY3V0ZWQgPSB0cnVlO1xuICAgICAgY29uc3QgY29uc29sZUFwcGVuZGVyID0gSkwuY3JlYXRlQ29uc29sZUFwcGVuZGVyKCdjb25zb2xlQXBwZW5kZXInKTtcblxuICAgICAgSkwoKS5zZXRPcHRpb25zKHtcbiAgICAgICAgYXBwZW5kZXJzOiBbY29uc29sZUFwcGVuZGVyXVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cblxuICBzdGF0aWMgY3JlYXRlTG9nZ2VyKGxvZ2dlck5hbWU6IHN0cmluZyk6IFByb3ZpZGVyW10ge1xuICAgIHJldHVybiBbXG4gICAgICBLYWx0dXJhTG9nZ2VyLFxuICAgICAge1xuICAgICAgICBwcm92aWRlOiBLYWx0dXJhTG9nZ2VyTmFtZSwgdXNlVmFsdWU6IGxvZ2dlck5hbWVcbiAgICAgIH1cbiAgICBdO1xuICB9XG5cblxuICBwcml2YXRlIF9uYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgX2xvZ2dlcjogSkwuSlNOTG9nTG9nZ2VyO1xuXG4gIHB1YmxpYyBnZXQgbmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLl9uYW1lO1xuICB9XG5cblxuICBjb25zdHJ1Y3RvcihASW5qZWN0KEthbHR1cmFMb2dnZXJOYW1lKSBAT3B0aW9uYWwoKSBAU2VsZigpIG5hbWU6IHN0cmluZyxcbiAgICAgICAgICAgICAgQFNraXBTZWxmKCkgQE9wdGlvbmFsKCkgcGFyZW50TG9nZ2VyOiBLYWx0dXJhTG9nZ2VyLFxuICAgICAgICAgICAgICBAT3B0aW9uYWwoKSBwcml2YXRlIF9sb2dnZXJSZWNvcmRJbnRlcmNlcHRvcjogS2FsdHVyYUxvZ2dlclJlY29yZFNlcnZpY2UpIHtcblxuICAgIEthbHR1cmFMb2dnZXIucmVzZXREZWZhdWx0SlNOTG9nKCk7XG5cbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIG5hbWUgPSAnbG9nZ2VyJyArIHJhbmRvbUxvZ2dlck5hbWVOdW1iZXI7XG4gICAgICByYW5kb21Mb2dnZXJOYW1lTnVtYmVyKys7XG4gICAgfVxuXG4gICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvWy5dL2csICdfJyk7XG5cbiAgICB0aGlzLl9uYW1lID0gcGFyZW50TG9nZ2VyID8gYCR7cGFyZW50TG9nZ2VyLm5hbWV9LiR7bmFtZX1gIDogbmFtZTtcbiAgICB0aGlzLl9sb2dnZXIgPSBKTCh0aGlzLl9uYW1lKTtcbiAgICB0aGlzLl9sb2dnZXIudHJhY2UoJ2xvZ2dlciBjcmVhdGVkIScpO1xuICB9XG5cbiAgcHJpdmF0ZSBfYWRkTG9nVG9CdWZmZXIobG9nSXRlbTogYW55KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2xvZ2dlclJlY29yZEludGVyY2VwdG9yKSB7XG4gICAgICB0aGlzLl9sb2dnZXJSZWNvcmRJbnRlcmNlcHRvci5hZGRMb2dJdGVtVG9CdWZmZXIobG9nSXRlbSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXJ0UmVjb3JkaW5nTG9ncygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fbG9nZ2VyUmVjb3JkSW50ZXJjZXB0b3IpIHtcbiAgICAgIHRoaXMuX2xvZ2dlclJlY29yZEludGVyY2VwdG9yLnN0YXJ0UmVjb3JkKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGdldFJlY29yZGVkTG9ncygpOiBhbnlbXSB8IHZvaWQge1xuICAgIGlmICh0aGlzLl9sb2dnZXJSZWNvcmRJbnRlcmNlcHRvcikge1xuICAgICAgcmV0dXJuIHRoaXMuX2xvZ2dlclJlY29yZEludGVyY2VwdG9yLmdldFJlY29yZGVkTG9ncygpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBpc1ZhbGlkTG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVscyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHZhbGlkTG9nTGV2ZWxzID0gWydBbGwnLCAnVHJhY2UnLCAnRGVidWcnLCAnSW5mbycsICdXYXJuJywgJ0Vycm9yJywgJ0ZhdGFsJywgJ09mZiddO1xuICAgIHJldHVybiB2YWxpZExvZ0xldmVscy5pbmRleE9mKGxldmVsKSAhPT0gLTE7XG4gIH1cblxuICBwdWJsaWMgc2V0T3B0aW9ucyhvcHRpb25zOiB7IGxldmVsPzogTG9nTGV2ZWxzIH0pOiB2b2lkIHtcbiAgICBsZXQgbGV2ZWw6IG51bWJlciA9IHVuZGVmaW5lZDtcbiAgICBpZiAodGhpcy5pc1ZhbGlkTG9nTGV2ZWwob3B0aW9ucy5sZXZlbCkgJiYgSkwpIHtcbiAgICAgIGNvbnN0IGdldExldmVsVmFsdWUgPSBKTFtgZ2V0JHtvcHRpb25zLmxldmVsfUxldmVsYF07XG4gICAgICBsZXZlbCA9IHR5cGVvZiBnZXRMZXZlbFZhbHVlID09PSAnZnVuY3Rpb24nID8gZ2V0TGV2ZWxWYWx1ZSgpIDogdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIEpMKCkuc2V0T3B0aW9ucyh7bGV2ZWw6IGxldmVsfSk7XG4gIH1cblxuICBwdWJsaWMgc3ViTG9nZ2VyKG5hbWU6IHN0cmluZyk6IEthbHR1cmFMb2dnZXIge1xuICAgIHJldHVybiBuZXcgS2FsdHVyYUxvZ2dlcihuYW1lLCB0aGlzLCB0aGlzLl9sb2dnZXJSZWNvcmRJbnRlcmNlcHRvcik7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9sb2dnZXIuZGVidWcoJ2xvZ2dlciBkZXN0cm95ZWQnKTtcbiAgICBkZWxldGUgdGhpcy5fbG9nZ2VyO1xuXG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVMb2dPYmplY3QobGV2ZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0OiBDb250ZXh0IHwgRXJyb3IpOiBhbnkge1xuICAgIHRoaXMuX2FkZExvZ1RvQnVmZmVyKHtsZXZlbCwgbWVzc2FnZSwgY29udGV4dH0pO1xuICAgIHJldHVybiBjb250ZXh0ID8gT2JqZWN0LmFzc2lnbih7bWVzc2FnZSwgbGV2ZWx9LCBjb250ZXh0KSA6IG1lc3NhZ2U7XG4gIH1cblxuICBwdWJsaWMgdHJhY2UobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogQ29udGV4dCk6IHZvaWQ7XG4gIHB1YmxpYyB0cmFjZShtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBEZWZmZXJlZENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgdHJhY2UobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogQ29udGV4dCB8IERlZmZlcmVkQ29udGV4dCk6IHZvaWQge1xuICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLl9sb2dnZXIudHJhY2UoKCkgPT4gdGhpcy5fY3JlYXRlTG9nT2JqZWN0KCd0cmFjZScsIG1lc3NhZ2UsICg8RnVuY3Rpb24+Y29udGV4dCkoKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9sb2dnZXIudHJhY2UodGhpcy5fY3JlYXRlTG9nT2JqZWN0KCd0cmFjZScsIG1lc3NhZ2UsIDxDb250ZXh0PmNvbnRleHQpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogQ29udGV4dCk6IHZvaWQ7XG4gIHB1YmxpYyBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBEZWZmZXJlZENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogQ29udGV4dCB8IERlZmZlcmVkQ29udGV4dCk6IHZvaWQge1xuICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoKCkgPT4gdGhpcy5fY3JlYXRlTG9nT2JqZWN0KCdkZWJ1ZycsIG1lc3NhZ2UsICg8RnVuY3Rpb24+Y29udGV4dCkoKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcodGhpcy5fY3JlYXRlTG9nT2JqZWN0KCdkZWJ1ZycsIG1lc3NhZ2UsIDxDb250ZXh0PmNvbnRleHQpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBDb250ZXh0KTogdm9pZDtcbiAgcHVibGljIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogRGVmZmVyZWRDb250ZXh0KTogdm9pZDtcbiAgcHVibGljIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogQ29udGV4dCB8IERlZmZlcmVkQ29udGV4dCk6IHZvaWQge1xuICAgIGlmIChjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuaW5mbygoKSA9PiB0aGlzLl9jcmVhdGVMb2dPYmplY3QoJ2luZm8nLCBtZXNzYWdlLCAoPEZ1bmN0aW9uPmNvbnRleHQpKCkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fbG9nZ2VyLmluZm8odGhpcy5fY3JlYXRlTG9nT2JqZWN0KCdpbmZvJywgbWVzc2FnZSwgPENvbnRleHQ+Y29udGV4dCkpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyB3YXJuKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBEZWZmZXJlZENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBDb250ZXh0IHwgRGVmZmVyZWRDb250ZXh0KTogdm9pZCB7XG4gICAgaWYgKGNvbnRleHQgJiYgdHlwZW9mIGNvbnRleHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRoaXMuX2xvZ2dlci53YXJuKCgpID0+IHRoaXMuX2NyZWF0ZUxvZ09iamVjdCgnd2FybicsIG1lc3NhZ2UsICg8RnVuY3Rpb24+Y29udGV4dCkoKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9sb2dnZXIud2Fybih0aGlzLl9jcmVhdGVMb2dPYmplY3QoJ3dhcm4nLCBtZXNzYWdlLCA8Q29udGV4dD5jb250ZXh0KSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBlcnJvcj86IEVycm9yKTogdm9pZDtcbiAgcHVibGljIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IEVycm9yIHwgQ29udGV4dCk6IHZvaWQge1xuICAgIHRoaXMuX2xvZ2dlci5lcnJvcih0aGlzLl9jcmVhdGVMb2dPYmplY3QoJ2Vycm9yJywgbWVzc2FnZSwgY29udGV4dCkpO1xuICB9XG5cbiAgcHVibGljIGZhdGFsKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IENvbnRleHQpOiB2b2lkO1xuICBwdWJsaWMgZmF0YWwobWVzc2FnZTogc3RyaW5nLCBlcnJvcj86IEVycm9yKTogdm9pZDtcbiAgcHVibGljIGZhdGFsKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IEVycm9yIHwgQ29udGV4dCk6IHZvaWQge1xuICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgdGhpcy5fbG9nZ2VyLmZhdGFsRXhjZXB0aW9uKG1lc3NhZ2UsIGNvbnRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZmF0YWwodGhpcy5fY3JlYXRlTG9nT2JqZWN0KCdmYXRhbCcsIG1lc3NhZ2UsIGNvbnRleHQpKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==