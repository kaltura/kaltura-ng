<div #container [ngClass]="{'p-multiselect p-component':true,'p-multiselect-open':overlayVisible,'p-focus':focus,'p-disabled': disabled}" [ngStyle]="style" [class]="styleClass"
       (click)="onMouseclick($event,in)">
  <div class="p-hidden-accessible">
    <input #in type="text" readonly="readonly" [attr.id]="inputId" [attr.name]="name" (focus)="onInputFocus($event)" (blur)="onInputBlur($event)"
           [disabled]="disabled" [attr.tabindex]="tabindex" (keydown)="onKeydown($event)" aria-haspopup="listbox" [attr.aria-expanded]="overlayVisible"
           [attr.aria-labelledby]="ariaLabelledBy" role="listbox">
  </div>
  <div class="p-multiselect-label-container"  [title]="valuesAsString">
    <div class="p-multiselect-label" [ngClass]="{'p-placeholder': valuesAsString === (defaultLabel || placeholder), 'p-multiselect-label-empty': ((valuesAsString == null || valuesAsString.length === 0) && (placeholder == null || placeholder.length === 0))}">
      <ng-container *ngIf="!selectedItemsTemplate">{{isAllChecked() ? (allSelectedLabel || valuesAsString) : valuesAsString}}</ng-container>
      <ng-container *ngTemplateOutlet="selectedItemsTemplate; context: {$implicit: value}"></ng-container>
    </div>
  </div>
  <div [ngClass]="{'p-multiselect-trigger':true}">
    <span class="p-multiselect-trigger-icon" [ngClass]="dropdownIcon"></span>
  </div>

  <div *ngIf="overlayVisible" [ngClass]="['p-multiselect-panel p-component']" [@overlayAnimation]="{value: 'visible', params: {showTransitionParams: showTransitionOptions, hideTransitionParams: hideTransitionOptions}}" (@overlayAnimation.start)="onOverlayAnimationStart($event)"
       [ngStyle]="panelStyle" [class]="panelStyleClass" (keydown)="onKeydown($event)">
    <div class="p-multiselect-header" *ngIf="showHeader">
      <ng-content select="p-header"></ng-content>
      <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>
      <div class="p-checkbox p-component" *ngIf="showToggleAll && !selectionLimit">
        <div class="p-hidden-accessible">
          <input type="checkbox" readonly="readonly" [checked]="isAllChecked()" (focus)="onHeaderCheckboxFocus()" (blur)="onHeaderCheckboxBlur()" (keydown.space)="toggleAll($event)">
        </div>
        <div class="p-checkbox-box" role="checkbox" [attr.aria-checked]="isAllChecked()" [ngClass]="{'p-highlight':isAllChecked(), 'p-focus': headerCheckboxFocus}" (click)="toggleAll($event)">
          <span class="p-checkbox-icon" [ngClass]="{'pi pi-check':isAllChecked(), 'pi-minus':isPartiallyChecked()}"></span>
        </div>
      </div>
      <div class="p-multiselect-filter-container" *ngIf="filter">
        <input #filterInput type="text" role="textbox" [value]="filterValue||''" (input)="onFilter()" class="p-multiselect-filter p-inputtext p-component" [attr.placeholder]="filterPlaceHolder" [attr.aria-label]="ariaFilterLabel">
        <span class="p-multiselect-filter-icon pi pi-search"></span>
      </div>
      <button class="p-multiselect-close p-link" type="button" (click)="close($event)" pRipple>
        <span class="p-multiselect-close-icon pi pi-times"></span>
      </button>
    </div>
    <div class="p-multiselect-items-wrapper" [style.max-height]="virtualScroll ? 'auto' : (scrollHeight||'auto')">
      <ul class="p-multiselect-items p-component" role="listbox" aria-multiselectable="true">
        <ng-container *ngIf="!virtualScroll; else virtualScrollList">
          <ng-template ngFor let-option let-i="index" [ngForOf]="visibleOptions">
            <p-multiSelectItem [option]="option" [selected]="isSelected(option.value)" (onClick)="onOptionClick($event)" (onKeydown)="onOptionKeydown($event)"
                               [maxSelectionLimitReached]="maxSelectionLimitReached" [template]="itemTemplate"></p-multiSelectItem>
          </ng-template>
        </ng-container>
        <ng-template #virtualScrollList>
          <cdk-virtual-scroll-viewport #viewport [ngStyle]="{'height': scrollHeight}" [itemSize]="itemSize" *ngIf="virtualScroll && visibleOptions && visibleOptions.length">
            <ng-container *cdkVirtualFor="let option of visibleOptions; let i = index; let c = count; let f = first; let l = last; let e = even; let o = odd">
              <p-multiSelectItem [option]="option" [selected]="isSelected(option.value)" (onClick)="onOptionClick($event)" (onKeydown)="onOptionKeydown($event)"
                                 [maxSelectionLimitReached]="maxSelectionLimitReached" [template]="itemTemplate" [itemSize]="itemSize"></p-multiSelectItem>
            </ng-container>
          </cdk-virtual-scroll-viewport>
        </ng-template>
        <li *ngIf="filter && visibleOptions && visibleOptions.length === 0" class="p-multiselect-empty-message">{{emptyFilterMessage}}</li>
      </ul>
    </div>
    <div class="p-multiselect-footer" *ngIf="footerFacet || footerTemplate">
      <ng-content select="p-footer"></ng-content>
      <ng-container *ngTemplateOutlet="footerTemplate"></ng-container>
    </div>
  </div>
</div>
