import { __decorate, __metadata } from "tslib";
import { Component, EventEmitter, Input, Output, ViewChild, ViewChildren, QueryList, HostListener, ElementRef, ContentChildren, TemplateRef, } from '@angular/core';
import { TagComponent } from './tag.component';
import * as $NS from 'jquery';
const $ = $NS;
let TagsComponent = class TagsComponent {
    constructor() {
        this.disabled = false;
        this.removableTags = true;
        this.showClear = true;
        this.clearAllLabel = "Clear All";
        this.onTagRemove = new EventEmitter();
        this.onRemoveAll = new EventEmitter();
        this.onTagsChange = new EventEmitter();
        this._showMore = false;
        this._scrollLeftEnabled = false;
        this._scrollRightEnabled = true;
    }
    onWindowResize() {
        this.checkShowMore();
    }
    ngOnChanges(changes) {
        if (changes['data']) {
            if (this.disabledField && Array.isArray(this.data)) {
                this.data.sort((a, b) => Number(b[this.disabledField] || 0) - Number(a[this.disabledField] || 0));
            }
            this.checkShowMore();
        }
    }
    ngAfterViewInit() {
        this.tagsListObserver = this.tagsList.changes.subscribe((comps) => {
            this.onTagsChange.emit({ tagsCount: (this.data ? this.data.length : 0) });
            this.checkShowMore();
        });
    }
    ngOnDestroy() {
        if (this.tagsListObserver) {
            this.tagsListObserver.unsubscribe();
            this.tagsListObserver = null;
        }
    }
    removeTag(tag) {
        this.onTagRemove.emit(tag);
    }
    clearAll() {
        this.onRemoveAll.emit();
    }
    checkShowMore() {
        // we use a cancelable interval to improve performances on window resize
        if (this.showMoreCheckIntervalID) {
            clearInterval(this.showMoreCheckIntervalID);
            this.showMoreCheckIntervalID = null;
        }
        this.showMoreCheckIntervalID = setTimeout(() => {
            if (this.data && this.data.length && this.scroller) {
                this._showMore = this.scroller.nativeElement.scrollWidth > (this.scroller.nativeElement.getBoundingClientRect().width + 1);
            }
            this.showMoreCheckIntervalID = null;
        }, 100);
    }
    scroll(direction) {
        const scrollPageWidth = this.scroller.nativeElement.getBoundingClientRect().width;
        const totalScroll = this.scroller.nativeElement.scrollWidth;
        if (direction === "right") {
            const targetScrollLeft = this.scroller.nativeElement.scrollLeft + scrollPageWidth;
            $(this.scroller.nativeElement).animate({ scrollLeft: targetScrollLeft }, 800, () => {
                this._scrollLeftEnabled = true;
                if ((this.scroller.nativeElement.scrollLeft + scrollPageWidth) >= (totalScroll - 1)) {
                    this._scrollRightEnabled = false;
                }
            });
        }
        else {
            const targetScrollLeft = this.scroller.nativeElement.scrollLeft - scrollPageWidth;
            $(this.scroller.nativeElement).animate({ scrollLeft: targetScrollLeft }, 800, () => {
                this._scrollRightEnabled = true;
                if (this.scroller.nativeElement.scrollLeft <= 1) {
                    this._scrollLeftEnabled = false;
                }
            });
        }
    }
};
__decorate([
    Input(),
    __metadata("design:type", Array)
], TagsComponent.prototype, "data", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TagsComponent.prototype, "disabled", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TagsComponent.prototype, "labelField", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TagsComponent.prototype, "tooltipField", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TagsComponent.prototype, "disabledField", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TagsComponent.prototype, "removableTags", void 0);
__decorate([
    Input(),
    __metadata("design:type", Boolean)
], TagsComponent.prototype, "showClear", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TagsComponent.prototype, "title", void 0);
__decorate([
    Input(),
    __metadata("design:type", String)
], TagsComponent.prototype, "clearAllLabel", void 0);
__decorate([
    ContentChildren(TemplateRef, { descendants: false }),
    __metadata("design:type", QueryList)
], TagsComponent.prototype, "templates", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], TagsComponent.prototype, "onTagRemove", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], TagsComponent.prototype, "onRemoveAll", void 0);
__decorate([
    Output(),
    __metadata("design:type", Object)
], TagsComponent.prototype, "onTagsChange", void 0);
__decorate([
    ViewChild('scroller', { static: false }),
    __metadata("design:type", ElementRef)
], TagsComponent.prototype, "scroller", void 0);
__decorate([
    ViewChildren(TagComponent),
    __metadata("design:type", QueryList)
], TagsComponent.prototype, "tagsList", void 0);
__decorate([
    HostListener("window:resize", []),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", void 0)
], TagsComponent.prototype, "onWindowResize", null);
TagsComponent = __decorate([
    Component({
        selector: 'kTags',
        template: "<div class=\"kTags\" *ngIf=\"data?.length\">\n    <span *ngIf=\"title\" class=\"kTagsTitle\">{{title}}</span>\n    <div #scroller class=\"kScroller\">\n        <div class=\"kTagsWrapper\">\n            <kTag *ngFor=\"let tag of data\"\n                  [data]=\"tag\"\n                  [template]=\"templates ? templates.first : undefined\"\n                  [showRemove]=\"removableTags\"\n                  [label]=\"labelField ? tag[labelField] : tag\"\n                  [tooltip]=\"tooltipField ? tag[tooltipField] : tag\"\n                  [disabled]=\"disabledField ? tag[disabledField] : false\"\n                  (onRemoved)=\"removeTag($event)\"></kTag>\n        </div>\n    </div>\n    <div class=\"kTagsMore\">\n        <div class=\"kScrollArrows\" [style.visibility]=\"_showMore ? 'visible' : 'hidden'\">\n            <i class=\"kIcondropdown_arrow_left kScrollArrow\" [class.disable]=\"!_scrollLeftEnabled\" (click)=\"scroll('left')\"></i>\n            <i class=\"kIcondropdown_arrow_right kScrollArrow\" [class.disable]=\"!_scrollRightEnabled\" (click)=\"scroll('right')\"></i>\n        </div>\n        <span *ngIf=\"showClear\" class=\"kTagsClear\" (click)=\"clearAll()\">{{clearAllLabel}}</span>\n    </div>\n\n</div>\n",
        styles: [":host{width:100%}.kTags{width:100%;height:40px;background-color:#fff;display:flex;flex-wrap:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-style:-ms-autohiding-scrollbar;align-items:center;border-top:1px solid #dadada;-ms-scroll-limit:0;overflow:hidden;-ms-overflow-style:none}.kTagsTitle{flex:0 0 auto;font-size:15px;color:#333;font-weight:700;margin-left:16px;margin-right:16px}.kTagsClear{margin-left:8px;margin-right:16px;flex-shrink:0;color:#333;font-size:15px;text-decoration:underline;cursor:pointer}.kTagsClear:hover{color:#00a784}.kMoreTagsBtn{flex-shrink:0}.kScroller{width:100%;overflow:hidden}.kTagsMore{align-items:center;display:flex;flex:0 0 auto;margin-left:8px}.kTagsWrapper{display:table;white-space:nowrap;border-collapse:separate;border-spacing:4px}.kScrollArrows{display:flex}.kScrollArrow{width:16px;margin-left:8px;margin-right:8px;cursor:pointer;color:#666}.kScrollArrow:hover{color:#333}.kScrollArrow.disable{cursor:auto;color:#ebebeb;pointer-events:none}.kScrollArrow.disable:hover{color:#ebebeb}"]
    }),
    __metadata("design:paramtypes", [])
], TagsComponent);
export { TagsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFncy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Aa2FsdHVyYS1uZy9rYWx0dXJhLXVpLyIsInNvdXJjZXMiOlsibGliL3RhZ3MvdGFncy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBR04sU0FBUyxFQUNULFlBQVksRUFDWixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixlQUFlLEVBQ2YsV0FBVyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUcvQyxPQUFPLEtBQUssR0FBRyxNQUFNLFFBQVEsQ0FBQztBQUM5QixNQUFNLENBQUMsR0FBRyxHQUFHLENBQUM7QUFPZCxJQUFhLGFBQWEsR0FBMUIsTUFBYSxhQUFhO0lBNkJ0QjtRQTFCTyxhQUFRLEdBQVksS0FBSyxDQUFDO1FBSTNCLGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFFMUIsa0JBQWEsR0FBVyxXQUFXLENBQUM7UUFJaEMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN6QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUF1QixDQUFDO1FBUTFELGNBQVMsR0FBWSxLQUFLLENBQUM7UUFFM0IsdUJBQWtCLEdBQVksS0FBSyxDQUFDO1FBQ3BDLHdCQUFtQixHQUFZLElBQUksQ0FBQztJQUd4QyxDQUFDO0lBR0osY0FBYztRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRUEsV0FBVyxDQUFDLE9BQXNCO1FBQzlCLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLElBQUksSUFBSSxDQUFDLGFBQWEsSUFBSSxLQUFLLENBQUMsT0FB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OztrREFBdUM7QUFDdEM7SUFBVCxNQUFNLEVBQUU7O2tEQUF1QztBQUN6QztJQUFULE1BQU0sRUFBRTs7bURBQXdEO0FBRXZCO0lBQXpDLFNBQVMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7OEJBQVcsVUFBVTsrQ0FBQztBQUcvRDtJQURDLFlBQVksQ0FBQyxZQUFZLENBQUM7OEJBQ1QsU0FBUzsrQ0FBSztBQVloQztJQURDLFlBQVksQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUFDOzs7O21EQUdqQztBQW5DVyxhQUFhO0lBTHpCLFNBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLHF1Q0FBb0M7O0tBRXZDLENBQUM7O0dBQ1csYUFBYSxDQTBHekI7U0ExR1ksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBBZnRlclZpZXdJbml0LFxuICBPbkRlc3Ryb3ksXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIEhvc3RMaXN0ZW5lcixcbiAgRWxlbWVudFJlZixcbiAgQ29udGVudENoaWxkcmVuLFxuICBUZW1wbGF0ZVJlZiwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFRhZ0NvbXBvbmVudCB9IGZyb20gJy4vdGFnLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tIFwicnhqcy9TdWJzY3JpcHRpb25cIjtcblxuaW1wb3J0ICogYXMgJE5TIGZyb20gJ2pxdWVyeSc7XG5jb25zdCAkID0gJE5TO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2tUYWdzJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGFncy5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdGFncy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFRhZ3NDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgZGF0YTogYW55W107XG4gIEBJbnB1dCgpIGRpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgpIGxhYmVsRmllbGQ6IHN0cmluZztcblx0QElucHV0KCkgdG9vbHRpcEZpZWxkOiBzdHJpbmc7XG5cdEBJbnB1dCgpIGRpc2FibGVkRmllbGQ6IHN0cmluZztcblx0QElucHV0KCkgcmVtb3ZhYmxlVGFnczogYm9vbGVhbiA9IHRydWU7XG5cdEBJbnB1dCgpIHNob3dDbGVhcjogYm9vbGVhbiA9IHRydWU7XG5cdEBJbnB1dCgpIHRpdGxlOiBzdHJpbmc7XG5cdEBJbnB1dCgpIGNsZWFyQWxsTGFiZWw6IHN0cmluZyA9IFwiQ2xlYXIgQWxsXCI7XG5cblx0QENvbnRlbnRDaGlsZHJlbihUZW1wbGF0ZVJlZiwge2Rlc2NlbmRhbnRzOiBmYWxzZX0pIHB1YmxpYyB0ZW1wbGF0ZXM6IFF1ZXJ5TGlzdDxUZW1wbGF0ZVJlZjxhbnk+PjtcblxuICAgIEBPdXRwdXQoKSBvblRhZ1JlbW92ZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIEBPdXRwdXQoKSBvblJlbW92ZUFsbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXHRAT3V0cHV0KCkgb25UYWdzQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjx7dGFnc0NvdW50OiBudW1iZXJ9PigpO1xuXG5cdEBWaWV3Q2hpbGQoJ3Njcm9sbGVyJywgeyBzdGF0aWM6IGZhbHNlIH0pIHNjcm9sbGVyOiBFbGVtZW50UmVmO1xuXG5cdEBWaWV3Q2hpbGRyZW4oVGFnQ29tcG9uZW50KVxuXHRwcml2YXRlIHRhZ3NMaXN0OiBRdWVyeUxpc3Q8YW55PlxuXHRwcml2YXRlIHRhZ3NMaXN0T2JzZXJ2ZXI6IFN1YnNjcmlwdGlvbjtcbiBcblx0cHVibGljIF9zaG93TW9yZTogYm9vbGVhbiA9IGZhbHNlO1xuXHRwcml2YXRlIHNob3dNb3JlQ2hlY2tJbnRlcnZhbElEOiBudW1iZXI7XG5cdHB1YmxpYyBfc2Nyb2xsTGVmdEVuYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblx0cHVibGljIF9zY3JvbGxSaWdodEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgfVxuXG5cdEBIb3N0TGlzdGVuZXIoXCJ3aW5kb3c6cmVzaXplXCIsIFtdKVxuXHRvbldpbmRvd1Jlc2l6ZSgpIHtcblx0XHR0aGlzLmNoZWNrU2hvd01vcmUoKTtcblx0fVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICAgIGlmIChjaGFuZ2VzWydkYXRhJ10pIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWRGaWVsZCAmJiBBcnJheS5pc0FycmF5KHRoaXMuZGF0YSkpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YS5zb3J0KChhLCBiKSA9PiBOdW1iZXIoYlt0aGlzLmRpc2FibGVkRmllbGRdIHx8IDApIC0gTnVtYmVyKGFbdGhpcy5kaXNhYmxlZEZpZWxkXSB8fCAwKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNoZWNrU2hvd01vcmUoKTtcbiAgICAgIH1cbiAgfVxuXG5cdG5nQWZ0ZXJWaWV3SW5pdCgpe1xuXHRcdHRoaXMudGFnc0xpc3RPYnNlcnZlciA9IHRoaXMudGFnc0xpc3QuY2hhbmdlcy5zdWJzY3JpYmUoKGNvbXBzOiBRdWVyeUxpc3QgPGFueT4pID0+XG5cdFx0e1xuXHRcdFx0dGhpcy5vblRhZ3NDaGFuZ2UuZW1pdCh7dGFnc0NvdW50OiAodGhpcy5kYXRhID8gdGhpcy5kYXRhLmxlbmd0aCA6IDApIH0pO1xuXHRcdFx0dGhpcy5jaGVja1Nob3dNb3JlKCk7XG5cdFx0fSk7XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpe1xuXHRcdGlmICh0aGlzLnRhZ3NMaXN0T2JzZXJ2ZXIpe1xuXHRcdFx0dGhpcy50YWdzTGlzdE9ic2VydmVyLnVuc3Vic2NyaWJlKCk7XG5cdFx0XHR0aGlzLnRhZ3NMaXN0T2JzZXJ2ZXIgPSBudWxsO1xuXHRcdH1cblx0fVxuXG4gICAgcmVtb3ZlVGFnKHRhZzogYW55KXtcbiAgICBcdHRoaXMub25UYWdSZW1vdmUuZW1pdCh0YWcpO1xuICAgIH1cblxuICAgIGNsZWFyQWxsKCl7XG4gICAgXHR0aGlzLm9uUmVtb3ZlQWxsLmVtaXQoKTtcbiAgICB9XG5cblx0Y2hlY2tTaG93TW9yZSgpe1xuXHRcdC8vIHdlIHVzZSBhIGNhbmNlbGFibGUgaW50ZXJ2YWwgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZXMgb24gd2luZG93IHJlc2l6ZVxuXHRcdGlmICh0aGlzLnNob3dNb3JlQ2hlY2tJbnRlcnZhbElEKXtcblx0XHRcdGNsZWFySW50ZXJ2YWwodGhpcy5zaG93TW9yZUNoZWNrSW50ZXJ2YWxJRCk7XG5cdFx0XHR0aGlzLnNob3dNb3JlQ2hlY2tJbnRlcnZhbElEID0gbnVsbDtcblx0XHR9XG5cdFx0dGhpcy5zaG93TW9yZUNoZWNrSW50ZXJ2YWxJRCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0aWYgKHRoaXMuZGF0YSAmJiB0aGlzLmRhdGEubGVuZ3RoICYmIHRoaXMuc2Nyb2xsZXIpe1xuXHRcdFx0XHR0aGlzLl9zaG93TW9yZSA9IHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxXaWR0aCA+ICh0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggKyAxKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuc2hvd01vcmVDaGVja0ludGVydmFsSUQgPSBudWxsO1xuXHRcdH0sMTAwKTtcblx0fVxuXG5cdHNjcm9sbChkaXJlY3Rpb246IHN0cmluZyl7XG5cdFx0Y29uc3Qgc2Nyb2xsUGFnZVdpZHRoID0gdGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuXHRcdGNvbnN0IHRvdGFsU2Nyb2xsID0gdGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoO1xuXHRcdGlmIChkaXJlY3Rpb24gPT09IFwicmlnaHRcIil7XG5cdFx0XHRjb25zdCB0YXJnZXRTY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgKyBzY3JvbGxQYWdlV2lkdGg7XG5cdFx0XHQkKHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudCkuYW5pbWF0ZSh7c2Nyb2xsTGVmdDogdGFyZ2V0U2Nyb2xsTGVmdH0sIDgwMCwgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLl9zY3JvbGxMZWZ0RW5hYmxlZCA9IHRydWU7XG5cdFx0XHRcdGlmICgodGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgKyBzY3JvbGxQYWdlV2lkdGgpID49ICh0b3RhbFNjcm9sbC0xKSl7XG5cdFx0XHRcdFx0dGhpcy5fc2Nyb2xsUmlnaHRFbmFibGVkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1lbHNle1xuXHRcdFx0Y29uc3QgdGFyZ2V0U2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0IC0gc2Nyb2xsUGFnZVdpZHRoO1xuXHRcdFx0JCh0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQpLmFuaW1hdGUoe3Njcm9sbExlZnQ6IHRhcmdldFNjcm9sbExlZnR9LCA4MDAsICgpID0+IHtcblx0XHRcdFx0dGhpcy5fc2Nyb2xsUmlnaHRFbmFibGVkID0gdHJ1ZTtcblx0XHRcdFx0aWYgKHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0IDw9IDEpe1xuXHRcdFx0XHRcdHRoaXMuX3Njcm9sbExlZnRFbmFibGVkID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0fVxuXHR9XG59XG4iXX0=