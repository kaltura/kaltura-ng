import { __decorate, __metadata } from "tslib";
import { Component, EventEmitter, Input, Output, ViewChild, ViewChildren, QueryList, HostListener, ElementRef, ContentChildren, TemplateRef, } from '@angular/core';
import { TagComponent } from './tag.component';
import * as $NS from 'jquery';
var $ = $NS;
var TagsComponent = /** @class */ (function () {
    function TagsComponent() {
        this.disabled = false;
        this.removableTags = true;
        this.showClear = true;
        this.clearAllLabel = "Clear All";
        this.onTagRemove = new EventEmitter();
        this.onRemoveAll = new EventEmitter();
        this.onTagsChange = new EventEmitter();
        this._showMore = false;
        this._scrollLeftEnabled = false;
        this._scrollRightEnabled = true;
    }
    TagsComponent.prototype.onWindowResize = function () {
        this.checkShowMore();
    };
    TagsComponent.prototype.ngOnChanges = function (changes) {
        var _this = this;
        if (changes['data']) {
            if (this.disabledField && Array.isArray(this.data)) {
                this.data.sort(function (a, b) { return Number(b[_this.disabledField] || 0) - Number(a[_this.disabledField] || 0); });
            }
            this.checkShowMore();
        }
    };
    TagsComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        this.tagsListObserver = this.tagsList.changes.subscribe(function (comps) {
            _this.onTagsChange.emit({ tagsCount: (_this.data ? _this.data.length : 0) });
            _this.checkShowMore();
        });
    };
    TagsComponent.prototype.ngOnDestroy = function () {
        if (this.tagsListObserver) {
            this.tagsListObserver.unsubscribe();
            this.tagsListObserver = null;
        }
    };
    TagsComponent.prototype.removeTag = function (tag) {
        this.onTagRemove.emit(tag);
    };
    TagsComponent.prototype.clearAll = function () {
        this.onRemoveAll.emit();
    };
    TagsComponent.prototype.checkShowMore = function () {
        var _this = this;
        // we use a cancelable interval to improve performances on window resize
        if (this.showMoreCheckIntervalID) {
            clearInterval(this.showMoreCheckIntervalID);
            this.showMoreCheckIntervalID = null;
        }
        this.showMoreCheckIntervalID = setTimeout(function () {
            if (_this.data && _this.data.length && _this.scroller) {
                _this._showMore = _this.scroller.nativeElement.scrollWidth > (_this.scroller.nativeElement.getBoundingClientRect().width + 1);
            }
            _this.showMoreCheckIntervalID = null;
        }, 100);
    };
    TagsComponent.prototype.scroll = function (direction) {
        var _this = this;
        var scrollPageWidth = this.scroller.nativeElement.getBoundingClientRect().width;
        var totalScroll = this.scroller.nativeElement.scrollWidth;
        if (direction === "right") {
            var targetScrollLeft = this.scroller.nativeElement.scrollLeft + scrollPageWidth;
            $(this.scroller.nativeElement).animate({ scrollLeft: targetScrollLeft }, 800, function () {
                _this._scrollLeftEnabled = true;
                if ((_this.scroller.nativeElement.scrollLeft + scrollPageWidth) >= (totalScroll - 1)) {
                    _this._scrollRightEnabled = false;
                }
            });
        }
        else {
            var targetScrollLeft = this.scroller.nativeElement.scrollLeft - scrollPageWidth;
            $(this.scroller.nativeElement).animate({ scrollLeft: targetScrollLeft }, 800, function () {
                _this._scrollRightEnabled = true;
                if (_this.scroller.nativeElement.scrollLeft <= 1) {
                    _this._scrollLeftEnabled = false;
                }
            });
        }
    };
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], TagsComponent.prototype, "data", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], TagsComponent.prototype, "disabled", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], TagsComponent.prototype, "labelField", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], TagsComponent.prototype, "tooltipField", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], TagsComponent.prototype, "disabledField", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], TagsComponent.prototype, "removableTags", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], TagsComponent.prototype, "showClear", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], TagsComponent.prototype, "title", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], TagsComponent.prototype, "clearAllLabel", void 0);
    __decorate([
        ContentChildren(TemplateRef, { descendants: false }),
        __metadata("design:type", QueryList)
    ], TagsComponent.prototype, "templates", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TagsComponent.prototype, "onTagRemove", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TagsComponent.prototype, "onRemoveAll", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TagsComponent.prototype, "onTagsChange", void 0);
    __decorate([
        ViewChild('scroller', { static: false }),
        __metadata("design:type", ElementRef)
    ], TagsComponent.prototype, "scroller", void 0);
    __decorate([
        ViewChildren(TagComponent),
        __metadata("design:type", QueryList)
    ], TagsComponent.prototype, "tagsList", void 0);
    __decorate([
        HostListener("window:resize", []),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", []),
        __metadata("design:returntype", void 0)
    ], TagsComponent.prototype, "onWindowResize", null);
    TagsComponent = __decorate([
        Component({
            selector: 'kTags',
            template: "<div class=\"kTags\" *ngIf=\"data?.length\">\n    <span *ngIf=\"title\" class=\"kTagsTitle\">{{title}}</span>\n    <div #scroller class=\"kScroller\">\n        <div class=\"kTagsWrapper\">\n            <kTag *ngFor=\"let tag of data\"\n                  [data]=\"tag\"\n                  [template]=\"templates ? templates.first : undefined\"\n                  [showRemove]=\"removableTags\"\n                  [label]=\"labelField ? tag[labelField] : tag\"\n                  [tooltip]=\"tooltipField ? tag[tooltipField] : tag\"\n                  [disabled]=\"disabledField ? tag[disabledField] : false\"\n                  (onRemoved)=\"removeTag($event)\"></kTag>\n        </div>\n    </div>\n    <div class=\"kTagsMore\">\n        <div class=\"kScrollArrows\" [style.visibility]=\"_showMore ? 'visible' : 'hidden'\">\n            <i class=\"kIcondropdown_arrow_left kScrollArrow\" [class.disable]=\"!_scrollLeftEnabled\" (click)=\"scroll('left')\"></i>\n            <i class=\"kIcondropdown_arrow_right kScrollArrow\" [class.disable]=\"!_scrollRightEnabled\" (click)=\"scroll('right')\"></i>\n        </div>\n        <span *ngIf=\"showClear\" class=\"kTagsClear\" (click)=\"clearAll()\">{{clearAllLabel}}</span>\n    </div>\n\n</div>\n",
            styles: [":host{width:100%}.kTags{width:100%;height:40px;background-color:#fff;display:flex;flex-wrap:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-style:-ms-autohiding-scrollbar;align-items:center;border-top:1px solid #dadada;-ms-scroll-limit:0;overflow:hidden;-ms-overflow-style:none}.kTagsTitle{flex:0 0 auto;font-size:15px;color:#333;font-weight:700;margin-left:16px;margin-right:16px}.kTagsClear{margin-left:8px;margin-right:16px;flex-shrink:0;color:#333;font-size:15px;text-decoration:underline;cursor:pointer}.kTagsClear:hover{color:#00a784}.kMoreTagsBtn{flex-shrink:0}.kScroller{width:100%;overflow:hidden}.kTagsMore{align-items:center;display:flex;flex:0 0 auto;margin-left:8px}.kTagsWrapper{display:table;white-space:nowrap;border-collapse:separate;border-spacing:4px}.kScrollArrows{display:flex}.kScrollArrow{width:16px;margin-left:8px;margin-right:8px;cursor:pointer;color:#666}.kScrollArrow:hover{color:#333}.kScrollArrow.disable{cursor:auto;color:#ebebeb;pointer-events:none}.kScrollArrow.disable:hover{color:#ebebeb}"]
        }),
        __metadata("design:paramtypes", [])
    ], TagsComponent);
    return TagsComponent;
}());
export { TagsComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFncy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Aa2FsdHVyYS1uZy9rYWx0dXJhLXVpLyIsInNvdXJjZXMiOlsibGliL3RhZ3MvdGFncy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBR04sU0FBUyxFQUNULFlBQVksRUFDWixTQUFTLEVBQ1QsWUFBWSxFQUNaLFVBQVUsRUFDVixlQUFlLEVBQ2YsV0FBVyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUcvQyxPQUFPLEtBQUssR0FBRyxNQUFNLFFBQVEsQ0FBQztBQUM5QixJQUFNLENBQUMsR0FBRyxHQUFHLENBQUM7QUFPZDtJQTZCSTtRQTFCTyxhQUFRLEdBQVksS0FBSyxDQUFDO1FBSTNCLGtCQUFhLEdBQVksSUFBSSxDQUFDO1FBQzlCLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFFMUIsa0JBQWEsR0FBVyxXQUFXLENBQUM7UUFJaEMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBQ3RDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUN6QyxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUF1QixDQUFDO1FBUTFELGNBQVMsR0FBWSxLQUFLLENBQUM7UUFFM0IsdUJBQWtCLEdBQVksS0FBSyxDQUFDO1FBQ3BDLHdCQUFtQixHQUFZLElBQUksQ0FBQztJQUd4QyxDQUFDO0lBR0osc0NBQWMsR0FBZDtRQUNDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRUEsbUNBQVcsR0FBWCxVQUFZLE9BQXNCO1FBQWxDLGlCQVFDO1FBUEcsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbkIsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxPQUFPLENB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QW1CO0lBRXJGO1FBQVQsTUFBTSxFQUFFOztzREFBdUM7SUFDdEM7UUFBVCxNQUFNLEVBQUU7O3NEQUF1QztJQUN6QztRQUFULE1BQU0sRUFBRTs7dURBQXdEO0lBRXZCO1FBQXpDLFNBQVMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUM7a0NBQVcsVUFBVTttREFBQztJQUcvRDtRQURDLFlBQVksQ0FBQyxZQUFZLENBQUM7a0NBQ1QsU0FBUzttREFBSztJQVloQztRQURDLFlBQVksQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUFDOzs7O3VEQUdqQztJQW5DVyxhQUFhO1FBTHpCLFNBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxPQUFPO1lBQ2pCLHF1Q0FBb0M7O1NBRXZDLENBQUM7O09BQ1csYUFBYSxDQTBHekI7SUFBRCxvQkFBQztDQUFBLEFBMUdELElBMEdDO1NBMUdZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE91dHB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgT25EZXN0cm95LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDaGlsZHJlbixcbiAgUXVlcnlMaXN0LFxuICBIb3N0TGlzdGVuZXIsXG4gIEVsZW1lbnRSZWYsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgVGVtcGxhdGVSZWYsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcyxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUYWdDb21wb25lbnQgfSBmcm9tICcuL3RhZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSBcInJ4anMvU3Vic2NyaXB0aW9uXCI7XG5cbmltcG9ydCAqIGFzICROUyBmcm9tICdqcXVlcnknO1xuY29uc3QgJCA9ICROUztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdrVGFncycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RhZ3MuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3RhZ3MuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUYWdzQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIGRhdGE6IGFueVtdO1xuICBASW5wdXQoKSBkaXNhYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKSBsYWJlbEZpZWxkOiBzdHJpbmc7XG5cdEBJbnB1dCgpIHRvb2x0aXBGaWVsZDogc3RyaW5nO1xuXHRASW5wdXQoKSBkaXNhYmxlZEZpZWxkOiBzdHJpbmc7XG5cdEBJbnB1dCgpIHJlbW92YWJsZVRhZ3M6IGJvb2xlYW4gPSB0cnVlO1xuXHRASW5wdXQoKSBzaG93Q2xlYXI6IGJvb2xlYW4gPSB0cnVlO1xuXHRASW5wdXQoKSB0aXRsZTogc3RyaW5nO1xuXHRASW5wdXQoKSBjbGVhckFsbExhYmVsOiBzdHJpbmcgPSBcIkNsZWFyIEFsbFwiO1xuXG5cdEBDb250ZW50Q2hpbGRyZW4oVGVtcGxhdGVSZWYsIHtkZXNjZW5kYW50czogZmFsc2V9KSBwdWJsaWMgdGVtcGxhdGVzOiBRdWVyeUxpc3Q8VGVtcGxhdGVSZWY8YW55Pj47XG5cbiAgICBAT3V0cHV0KCkgb25UYWdSZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgICBAT3V0cHV0KCkgb25SZW1vdmVBbGwgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblx0QE91dHB1dCgpIG9uVGFnc0NoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8e3RhZ3NDb3VudDogbnVtYmVyfT4oKTtcblxuXHRAVmlld0NoaWxkKCdzY3JvbGxlcicsIHsgc3RhdGljOiBmYWxzZSB9KSBzY3JvbGxlcjogRWxlbWVudFJlZjtcblxuXHRAVmlld0NoaWxkcmVuKFRhZ0NvbXBvbmVudClcblx0cHJpdmF0ZSB0YWdzTGlzdDogUXVlcnlMaXN0PGFueT5cblx0cHJpdmF0ZSB0YWdzTGlzdE9ic2VydmVyOiBTdWJzY3JpcHRpb247XG4gXG5cdHB1YmxpYyBfc2hvd01vcmU6IGJvb2xlYW4gPSBmYWxzZTtcblx0cHJpdmF0ZSBzaG93TW9yZUNoZWNrSW50ZXJ2YWxJRDogbnVtYmVyO1xuXHRwdWJsaWMgX3Njcm9sbExlZnRFbmFibGVkOiBib29sZWFuID0gZmFsc2U7XG5cdHB1YmxpYyBfc2Nyb2xsUmlnaHRFbmFibGVkOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgIH1cblxuXHRASG9zdExpc3RlbmVyKFwid2luZG93OnJlc2l6ZVwiLCBbXSlcblx0b25XaW5kb3dSZXNpemUoKSB7XG5cdFx0dGhpcy5jaGVja1Nob3dNb3JlKCk7XG5cdH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICBpZiAoY2hhbmdlc1snZGF0YSddKSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkRmllbGQgJiYgQXJyYXkuaXNBcnJheSh0aGlzLmRhdGEpKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuc29ydCgoYSwgYikgPT4gTnVtYmVyKGJbdGhpcy5kaXNhYmxlZEZpZWxkXSB8fCAwKSAtIE51bWJlcihhW3RoaXMuZGlzYWJsZWRGaWVsZF0gfHwgMCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jaGVja1Nob3dNb3JlKCk7XG4gICAgICB9XG4gIH1cblxuXHRuZ0FmdGVyVmlld0luaXQoKXtcblx0XHR0aGlzLnRhZ3NMaXN0T2JzZXJ2ZXIgPSB0aGlzLnRhZ3NMaXN0LmNoYW5nZXMuc3Vic2NyaWJlKChjb21wczogUXVlcnlMaXN0IDxhbnk+KSA9PlxuXHRcdHtcblx0XHRcdHRoaXMub25UYWdzQ2hhbmdlLmVtaXQoe3RhZ3NDb3VudDogKHRoaXMuZGF0YSA/IHRoaXMuZGF0YS5sZW5ndGggOiAwKSB9KTtcblx0XHRcdHRoaXMuY2hlY2tTaG93TW9yZSgpO1xuXHRcdH0pO1xuXHR9XG5cblx0bmdPbkRlc3Ryb3koKXtcblx0XHRpZiAodGhpcy50YWdzTGlzdE9ic2VydmVyKXtcblx0XHRcdHRoaXMudGFnc0xpc3RPYnNlcnZlci51bnN1YnNjcmliZSgpO1xuXHRcdFx0dGhpcy50YWdzTGlzdE9ic2VydmVyID0gbnVsbDtcblx0XHR9XG5cdH1cblxuICAgIHJlbW92ZVRhZyh0YWc6IGFueSl7XG4gICAgXHR0aGlzLm9uVGFnUmVtb3ZlLmVtaXQodGFnKTtcbiAgICB9XG5cbiAgICBjbGVhckFsbCgpe1xuICAgIFx0dGhpcy5vblJlbW92ZUFsbC5lbWl0KCk7XG4gICAgfVxuXG5cdGNoZWNrU2hvd01vcmUoKXtcblx0XHQvLyB3ZSB1c2UgYSBjYW5jZWxhYmxlIGludGVydmFsIHRvIGltcHJvdmUgcGVyZm9ybWFuY2VzIG9uIHdpbmRvdyByZXNpemVcblx0XHRpZiAodGhpcy5zaG93TW9yZUNoZWNrSW50ZXJ2YWxJRCl7XG5cdFx0XHRjbGVhckludGVydmFsKHRoaXMuc2hvd01vcmVDaGVja0ludGVydmFsSUQpO1xuXHRcdFx0dGhpcy5zaG93TW9yZUNoZWNrSW50ZXJ2YWxJRCA9IG51bGw7XG5cdFx0fVxuXHRcdHRoaXMuc2hvd01vcmVDaGVja0ludGVydmFsSUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdGlmICh0aGlzLmRhdGEgJiYgdGhpcy5kYXRhLmxlbmd0aCAmJiB0aGlzLnNjcm9sbGVyKXtcblx0XHRcdFx0dGhpcy5fc2hvd01vcmUgPSB0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGggPiAodGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoICsgMSk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnNob3dNb3JlQ2hlY2tJbnRlcnZhbElEID0gbnVsbDtcblx0XHR9LDEwMCk7XG5cdH1cblxuXHRzY3JvbGwoZGlyZWN0aW9uOiBzdHJpbmcpe1xuXHRcdGNvbnN0IHNjcm9sbFBhZ2VXaWR0aCA9IHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aDtcblx0XHRjb25zdCB0b3RhbFNjcm9sbCA9IHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxXaWR0aDtcblx0XHRpZiAoZGlyZWN0aW9uID09PSBcInJpZ2h0XCIpe1xuXHRcdFx0Y29uc3QgdGFyZ2V0U2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ICsgc2Nyb2xsUGFnZVdpZHRoO1xuXHRcdFx0JCh0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQpLmFuaW1hdGUoe3Njcm9sbExlZnQ6IHRhcmdldFNjcm9sbExlZnR9LCA4MDAsICgpID0+IHtcblx0XHRcdFx0dGhpcy5fc2Nyb2xsTGVmdEVuYWJsZWQgPSB0cnVlO1xuXHRcdFx0XHRpZiAoKHRoaXMuc2Nyb2xsZXIubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ICsgc2Nyb2xsUGFnZVdpZHRoKSA+PSAodG90YWxTY3JvbGwtMSkpe1xuXHRcdFx0XHRcdHRoaXMuX3Njcm9sbFJpZ2h0RW5hYmxlZCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9ZWxzZXtcblx0XHRcdGNvbnN0IHRhcmdldFNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCAtIHNjcm9sbFBhZ2VXaWR0aDtcblx0XHRcdCQodGhpcy5zY3JvbGxlci5uYXRpdmVFbGVtZW50KS5hbmltYXRlKHtzY3JvbGxMZWZ0OiB0YXJnZXRTY3JvbGxMZWZ0fSwgODAwLCAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuX3Njcm9sbFJpZ2h0RW5hYmxlZCA9IHRydWU7XG5cdFx0XHRcdGlmICh0aGlzLnNjcm9sbGVyLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA8PSAxKXtcblx0XHRcdFx0XHR0aGlzLl9zY3JvbGxMZWZ0RW5hYmxlZCA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdH1cblx0fVxufVxuIl19