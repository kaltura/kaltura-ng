import { __decorate, __metadata } from "tslib";
import { Component, Input, TemplateRef, ContentChildren, QueryList } from '@angular/core';
import { FormArray, FormGroup, Validators, FormBuilder, AbstractControl } from '@angular/forms';
import { DynamicFormService } from './dynamic-form.service';
import { DynamicFormControlBase } from './dynamic-form-control-base';
var DynamicFormItem = /** @class */ (function () {
    function DynamicFormItem(_formBuilder, _dynamicFormService) {
        this._formBuilder = _formBuilder;
        this._dynamicFormService = _dynamicFormService;
    }
    DynamicFormItem.prototype.asDynamicSection = function (control) {
        return control;
    };
    DynamicFormItem.prototype.asFormGroup = function (control) {
        return control;
    };
    DynamicFormItem.prototype.ngOnInit = function () {
        this.isRequired = false;
        var validators = this.control.validators;
        if (this.control.validators) {
            var RequiredValidator = validators.find(function (validator) {
                return validator == Validators.required;
            });
            if (RequiredValidator) {
                this.isRequired = true;
            }
        }
    };
    DynamicFormItem.prototype.initItem = function (dynamicControl) {
        return this._dynamicFormService.toFormGroup([dynamicControl], { ignoreMultiple: true });
    };
    DynamicFormItem.prototype.addItem = function (dynamicControl) {
        var control = this.form.controls[dynamicControl.key];
        control.push(this.initItem(dynamicControl));
        control.markAsDirty();
    };
    DynamicFormItem.prototype.removeItem = function (dynamicControl, i) {
        var control = this.form.controls[dynamicControl.key];
        control.removeAt(i);
        control.markAsDirty();
    };
    DynamicFormItem.ctorParameters = function () { return [
        { type: FormBuilder },
        { type: DynamicFormService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", DynamicFormControlBase)
    ], DynamicFormItem.prototype, "control", void 0);
    __decorate([
        Input(),
        __metadata("design:type", FormGroup)
    ], DynamicFormItem.prototype, "form", void 0);
    __decorate([
        ContentChildren(TemplateRef, { descendants: false }),
        __metadata("design:type", QueryList)
    ], DynamicFormItem.prototype, "_templates", void 0);
    __decorate([
        Input(),
        __metadata("design:type", TemplateRef)
    ], DynamicFormItem.prototype, "labelTemplate", void 0);
    DynamicFormItem = __decorate([
        Component({
            selector: 'k-dynamic-form-item',
            template: "<div *ngIf=\"control\" [formGroup]=\"form\">\n\n    <ng-container  *ngIf=\"control.controlType === 'Group' && control.allowMultiple\">\n            <div class=\"kMultiple\" [formArrayName]=\"control.key\">\n                <span class=\"kGroupTitle\" *ngIf=\"control.label\">\n                    <span [kTooltip]=\"control.description\">{{control.label}}</span>\n                </span>\n                <div class=\"kGroupContainer\"  *ngFor=\"let groupForm of asFormGroup(form.controls[control.key]).controls; let i=index\">\n\n                    <div [formGroupName]=\"i\">\n                        <k-dynamic-form-item *ngFor=\"let childControl of asDynamicSection(control).children\"\n                                          [control]=\"childControl\"\n                                          [form]=\"groupForm\">\n                            <ng-template let-item=\"item\">\n                                <ng-container *ngTemplateOutlet=\"_templates.first;context:{ item : item }\">\n                                </ng-container>\n                            </ng-template>\n                        </k-dynamic-form-item>\n                    </div>\n\n                    <div class=\"kDeleteGroup\">\n                        <a (click)=\"!form.disabled && removeItem(control,i)\" [class.disabled]=\"form.disabled\">Delete</a>\n                    </div>\n                </div>\n\n                <div class=\"kGroupButtons\">\n                    <button (click)=\"addItem(control)\" class=\"kButton\" [disabled]=\"form.disabled\">Add</button>\n                </div>\n            </div>\n    </ng-container>\n\n    <div class=\"kMultiple\" *ngIf=\"control.controlType === 'Group' && !control.allowMultiple\">\n        <span class=\"kGroupTitle\" *ngIf=\"control.label\">\n            <span [kTooltip]=\"control.description\">{{control.label}}</span>\n        </span>\n        <k-dynamic-form-item *ngFor=\"let childControl of asDynamicSection(control).children\" [control]=\"childControl\" [form]=\"form\" [labelTemplate]=\"labelTemplate\">\n            <ng-template let-item=\"item\">\n                <ng-container *ngTemplateOutlet=\"_templates.first;context:{ item : item }\"></ng-container>\n            </ng-template>\n        </k-dynamic-form-item>\n    </div>\n\n    <div class=\"kRow\" [ngClass]=\"control.styleClass\" *ngIf=\"control.controlType !== 'Group'\">\n        <div class=\"kFormLabelContainer\">\n            <span class=\"kLabel\" *ngIf=\"control.label && !!labelTemplate == false\">{{control.label}}\n                <kInputHelper *ngIf=\"control.inputHelperConfig && control.inputHelperConfig.body\" [title]=\"control.inputHelperConfig.title\">\n                    <span [innerHTML]=\"control.inputHelperConfig.body\"></span>\n                </kInputHelper>\n            </span>\n            <ng-container *ngIf=\"!!labelTemplate\">\n                <ng-container *ngTemplateOutlet=\"labelTemplate;context:{item: { control : control, form : form, isRequired : isRequired }}\"></ng-container>\n            </ng-container>\n            <span *ngIf=\"isRequired\" class=\"kFormRequiredIndicator\">*</span>\n        </div>\n        <div class=\"kMultiple\" *ngIf=\"control.allowMultiple\" [formArrayName]=\"control.key\">\n\n            <div class=\"kSingleItem\" *ngFor=\"let itemFormGroup of asFormGroup(form.controls[control.key]).controls; let i=index\" [formGroupName]=\"i\">\n                    <ng-container *ngTemplateOutlet=\"_templates.first;context:{item: { control : control, form : itemFormGroup }}\"></ng-container>\n                <a (click)=\"!form.disabled && removeItem(control,i)\" class=\"kDelete\" [class.disabled]=\"form.disabled\">Delete</a>\n            </div>\n            <div>\n                <button class=\"kButton\" (click)=\"!form.disabled && addItem(control)\" [disabled]=\"form.disabled\">Add</button>\n            </div>\n        </div>\n\n        <div class=\"kControl\" [ngClass]=\"[control.controlType, control.key + 'Control']\" *ngIf=\"!control.allowMultiple\">\n            <ng-container *ngTemplateOutlet=\"_templates.first;context:{item: { control : control, form : form }}\"></ng-container>\n        </div>\n        <!--<div class=\"errorMessage\" *ngIf=\"form.controls[control.key].valid\">{{control.label}} is required</div>-->\n    </div>\n</div>\n\n",
            styles: [""]
        }),
        __metadata("design:paramtypes", [FormBuilder, DynamicFormService])
    ], DynamicFormItem);
    return DynamicFormItem;
}());
export { DynamicFormItem };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1mb3JtLWl0ZW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGthbHR1cmEtbmcva2FsdHVyYS11aS8iLCJzb3VyY2VzIjpbImxpYi9keW5hbWljLWZvcm0vZHluYW1pYy1mb3JtLWl0ZW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRyxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUcsV0FBVyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWpHLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzVELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBT3JFO0lBU0kseUJBQW9CLFlBQTBCLEVBQVUsbUJBQXdDO1FBQTVFLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQVUsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtJQUdoRyxDQUFDO0lBRUQsMENBQWdCLEdBQWhCLFVBQWlCLE9BQW9DO1FBQ25ELE9BQThCLE9BQU8sQ0FBQztJQUN4QyxDQUFDO0lBRUQscUNBQVcsR0FBWCxVQUFZLE9BQXdCO1FBQ2xDLE9BQWtCLE9BQU8sQ0FBQztJQUM1QixDQUFDO0lBRUQsa0NBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxVQUFVLEdBQUMsS0FBSyxDQUFDO1FBRXRCLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBQzNDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQzNCO1lBQ0ksSUFBTSxpQkFBaUIsR0FBRSxVQUFVLENBQUMsSUFBSSxDQUFFLFVBQUEsU0FBUztnQkFDbkQsT0FBQSxTQUFTLElBQUksVUFBVSxDQUFDLFFBQVE7WUFBaEMsQ0FBZ0MsQ0FBQyxDQUFDO1lBRWxDLElBQUksaUJBQWlCLEVBQ3JCO2dCQUNJLElBQUksQ0FBQyxVQUFVLEdBQUMsSUFBSSxDQUFDO2FBQ3hCO1NBQ0o7SUFDTCxDQUFDO0lBRUQsa0NBQVEsR0FBUixVQUFTLGNBQTRDO1FBQ2pELE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsY0FBYyxFQUFHLElBQUksRUFBQyxDQUFDLENBQUM7SUFDNUYsQ0FBQztJQUVELGlDQUFPLEdBQVAsVUFBUSxjQUE0QztRQUNoRCxJQUFNLE9BQU8sR0FBYyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEUsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCxvQ0FBVSxHQUFWLFVBQVcsY0FBNEMsRUFBRSxDQUFTO1FBQzlELElBQU0sT0FBTyxHQUFjLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsRSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUMxQixDQUFDOztnQkEzQ2tDLFdBQVc7Z0JBQWdDLGtCQUFrQjs7SUFSdkY7UUFBUixLQUFLLEVBQUU7a0NBQVUsc0JBQXNCO29EQUFNO0lBQ3JDO1FBQVIsS0FBSyxFQUFFO2tDQUFRLFNBQVM7aURBQUM7SUFJMEI7UUFBbkQsZUFBZSxDQUFDLFdBQVcsRUFBRSxFQUFDLFdBQVcsRUFBRSxLQUFLLEVBQUMsQ0FBQztrQ0FBb0IsU0FBUzt1REFBbUI7SUFDMUY7UUFBUixLQUFLLEVBQUU7a0NBQWdCLFdBQVc7MERBQU07SUFQaEMsZUFBZTtRQUwzQixTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUscUJBQXFCO1lBQy9CLGl3SUFBaUQ7O1NBRXBELENBQUM7eUNBVXFDLFdBQVcsRUFBZ0Msa0JBQWtCO09BVHZGLGVBQWUsQ0FxRDNCO0lBQUQsc0JBQUM7Q0FBQSxBQXJERCxJQXFEQztTQXJEWSxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgVGVtcGxhdGVSZWYsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1BcnJheSwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzLCAgRm9ybUJ1aWxkZXIsIEFic3RyYWN0Q29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IER5bmFtaWNTZWN0aW9uQ29udHJvbCB9IGZyb20gJy4vY29udHJvbHMvZHluYW1pYy1zZWN0aW9uLWNvbnRyb2wnO1xuaW1wb3J0IHsgRHluYW1pY0Zvcm1TZXJ2aWNlIH0gZnJvbSAnLi9keW5hbWljLWZvcm0uc2VydmljZSc7XG5pbXBvcnQgeyBEeW5hbWljRm9ybUNvbnRyb2xCYXNlIH0gZnJvbSAnLi9keW5hbWljLWZvcm0tY29udHJvbC1iYXNlJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdrLWR5bmFtaWMtZm9ybS1pdGVtJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZHluYW1pYy1mb3JtLWl0ZW0uY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJscyA6IFsnLi9keW5hbWljLWZvcm0taXRlbS5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIER5bmFtaWNGb3JtSXRlbSBpbXBsZW1lbnRzICBPbkluaXQge1xuICAgIEBJbnB1dCgpIGNvbnRyb2w6IER5bmFtaWNGb3JtQ29udHJvbEJhc2U8YW55PjtcbiAgICBASW5wdXQoKSBmb3JtIDogRm9ybUdyb3VwO1xuXG4gICAgcHVibGljIGlzUmVxdWlyZWQ6IGJvb2xlYW47XG5cbiAgICBAQ29udGVudENoaWxkcmVuKFRlbXBsYXRlUmVmLCB7ZGVzY2VuZGFudHM6IGZhbHNlfSkgcHVibGljIF90ZW1wbGF0ZXM6IFF1ZXJ5TGlzdDxUZW1wbGF0ZVJlZjxhbnk+PjtcbiAgICBASW5wdXQoKSBsYWJlbFRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfZm9ybUJ1aWxkZXIgOiBGb3JtQnVpbGRlciwgcHJpdmF0ZSBfZHluYW1pY0Zvcm1TZXJ2aWNlIDogRHluYW1pY0Zvcm1TZXJ2aWNlKVxuICAgIHtcblxuICAgIH1cblxuICAgIGFzRHluYW1pY1NlY3Rpb24oY29udHJvbDogRHluYW1pY0Zvcm1Db250cm9sQmFzZTxhbnk+KTogRHluYW1pY1NlY3Rpb25Db250cm9sIHtcbiAgICAgIHJldHVybiA8RHluYW1pY1NlY3Rpb25Db250cm9sPmNvbnRyb2w7XG4gICAgfVxuXG4gICAgYXNGb3JtR3JvdXAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogRm9ybUdyb3VwIHtcbiAgICAgIHJldHVybiA8Rm9ybUdyb3VwPmNvbnRyb2w7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuaXNSZXF1aXJlZD1mYWxzZTtcblxuICAgICAgICBjb25zdCB2YWxpZGF0b3JzID0gdGhpcy5jb250cm9sLnZhbGlkYXRvcnM7XG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2wudmFsaWRhdG9ycylcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgUmVxdWlyZWRWYWxpZGF0b3IgPXZhbGlkYXRvcnMuZmluZCggdmFsaWRhdG9yID0+XG4gICAgICAgICAgICB2YWxpZGF0b3IgPT0gVmFsaWRhdG9ycy5yZXF1aXJlZCk7XG5cbiAgICAgICAgICAgIGlmIChSZXF1aXJlZFZhbGlkYXRvcilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzUmVxdWlyZWQ9dHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGluaXRJdGVtKGR5bmFtaWNDb250cm9sIDogRHluYW1pY0Zvcm1Db250cm9sQmFzZTxhbnk+KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9keW5hbWljRm9ybVNlcnZpY2UudG9Gb3JtR3JvdXAoW2R5bmFtaWNDb250cm9sXSwgeyBpZ25vcmVNdWx0aXBsZSA6IHRydWV9KTtcbiAgICB9XG5cbiAgICBhZGRJdGVtKGR5bmFtaWNDb250cm9sIDogRHluYW1pY0Zvcm1Db250cm9sQmFzZTxhbnk+KSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2wgPSA8Rm9ybUFycmF5PnRoaXMuZm9ybS5jb250cm9sc1tkeW5hbWljQ29udHJvbC5rZXldO1xuICAgICAgICBjb250cm9sLnB1c2godGhpcy5pbml0SXRlbShkeW5hbWljQ29udHJvbCkpO1xuICAgICAgICBjb250cm9sLm1hcmtBc0RpcnR5KCk7XG4gICAgfVxuXG4gICAgcmVtb3ZlSXRlbShkeW5hbWljQ29udHJvbCA6IER5bmFtaWNGb3JtQ29udHJvbEJhc2U8YW55PiwgaTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2wgPSA8Rm9ybUFycmF5PnRoaXMuZm9ybS5jb250cm9sc1tkeW5hbWljQ29udHJvbC5rZXldO1xuICAgICAgICBjb250cm9sLnJlbW92ZUF0KGkpO1xuICAgICAgICBjb250cm9sLm1hcmtBc0RpcnR5KCk7XG4gICAgfVxufVxuIl19