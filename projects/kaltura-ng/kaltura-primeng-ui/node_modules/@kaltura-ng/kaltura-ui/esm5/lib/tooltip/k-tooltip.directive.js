import { __decorate, __metadata } from "tslib";
import { Directive, ElementRef, HostListener, Input, OnDestroy } from '@angular/core';
var KTooltipDirective = /** @class */ (function () {
    function KTooltipDirective(elementRef) {
        this.elementRef = elementRef;
        this._tooltipElement = null;
        this._tooltipContent = null;
        this._shouldBeVisible = false;
        this._tooltipHeight = null;
        this._tooltipWidth = null;
        this.tooltipResolver = null;
        this.escape = true;
        this.tooltipOffset = 8;
        this.placement = "top";
        this.delay = 300;
        this.maxWidth = 300;
        this.followTarget = false;
        this.showOnEllipsis = false;
    }
    Object.defineProperty(KTooltipDirective.prototype, "kTooltip", {
        set: function (value) {
            if (this.isValidContent(value)) {
                this._tooltipContent = value;
            }
            else {
                this._tooltipContent = null;
            }
            this._updateTooltipElement();
        },
        enumerable: true,
        configurable: true
    });
    KTooltipDirective.prototype.isValidContent = function (value) {
        return typeof value !== 'undefined' && value !== '' && value !== null;
    };
    KTooltipDirective.prototype._updateTooltipElement = function () {
        var _this = this;
        if (!this._tooltipContent) {
            if (this._isShowingTooltip()) {
                this._removeTooltipElement();
            }
        }
        else if (this._shouldBeVisible) {
            if (!this._isShowingTooltip()) {
                this._tooltipElement = document.createElement('span');
                this._tooltipElement.style.pointerEvents = 'none';
                this._tooltipElement.className += "ng-tooltip ng-tooltip-" + this.placement;
                if (this.maxWidth > 0) {
                    this._tooltipElement.style.maxWidth = this.maxWidth + "px";
                }
                var addTooltipVisibleClass = function () {
                    if (_this._tooltipElement) {
                        _this._tooltipElement.className += " ng-tooltip-show";
                    }
                };
                if (this.delay) {
                    setTimeout(addTooltipVisibleClass, this.delay);
                }
                else {
                    addTooltipVisibleClass();
                }
                document.body.appendChild(this._tooltipElement);
                if (this._updateTooltipElementContent()) {
                    this._updateTooltipElementPosition();
                }
            }
            else {
                if (this._updateTooltipElementContent()) {
                    this._updateTooltipElementPosition();
                }
            }
        }
        else {
            if (this._isShowingTooltip()) {
                this._removeTooltipElement();
            }
        }
    };
    KTooltipDirective.prototype.onMouseMove = function () {
        if (this.followTarget) {
            this._updateTooltipElementPosition();
        }
    };
    KTooltipDirective.prototype.onMouseEnter = function () {
        if (!this.showOnEllipsis || this.isInEllipsis()) {
            this._shouldBeVisible = true;
            this._updateTooltipElement();
        }
    };
    KTooltipDirective.prototype.onMouseLeave = function () {
        this._shouldBeVisible = false;
        this._updateTooltipElement();
    };
    KTooltipDirective.prototype.isInEllipsis = function () {
        // added the -1 threshold to support IE and edge which always show a 1px difference between offsetWidth and scrollWidth
        return this.elementRef.nativeElement.offsetWidth < (this.elementRef.nativeElement.scrollWidth - 1);
    };
    KTooltipDirective.prototype._removeTooltipElement = function () {
        if (this._tooltipElement) {
            if (this._tooltipElement.parentNode) {
                this._tooltipElement.parentNode.removeChild(this._tooltipElement);
            }
            this._tooltipElement = null;
            this._tooltipHeight = null;
            this._tooltipWidth = null;
        }
    };
    KTooltipDirective.prototype._isShowingTooltip = function () {
        return this._tooltipElement !== null;
    };
    KTooltipDirective.prototype._updateTooltipElementContent = function () {
        if (this._isShowingTooltip() && this._tooltipContent) {
            var content = '';
            if (this.tooltipResolver && typeof this.tooltipResolver === 'string') {
                content = this._tooltipContent[this.tooltipResolver];
            }
            else if (this.tooltipResolver && typeof this.tooltipResolver === 'function') {
                content = this.tooltipResolver(this._tooltipContent);
            }
            else {
                content = this._tooltipContent;
            }
            if (this.isValidContent(content)) {
                // re-check content type to handle scenarios when the tooltipResolver caused the value to be undefined
                this._tooltipElement.innerHTML = '';
                this._tooltipElement.textContent = '';
                if (this.escape) {
                    this._tooltipElement.textContent = content;
                }
                else {
                    this._tooltipElement.innerHTML = content;
                }
                this._tooltipHeight = this._tooltipElement.clientHeight;
                this._tooltipWidth = this._tooltipElement.offsetWidth;
                return true;
            }
            else {
                this._removeTooltipElement();
                return false;
            }
        }
    };
    KTooltipDirective.prototype._updateTooltipElementPosition = function () {
        if (this._isShowingTooltip()) {
            var elemPosition = this.elementRef.nativeElement.getBoundingClientRect();
            if (elemPosition) {
                var elemHeight = this.elementRef.nativeElement.offsetHeight;
                var elemWidth = this.elementRef.nativeElement.offsetWidth;
                if (this.placement == 'top') {
                    this._tooltipElement.style.top = elemPosition.top - (this._tooltipHeight + this.tooltipOffset) + 'px';
                }
                if (this.placement == 'bottom') {
                    this._tooltipElement.style.top = elemPosition.top + elemHeight + this.tooltipOffset + 'px';
                }
                if (this.placement == 'top' || this.placement == 'bottom') {
                    this._tooltipElement.style.left = (elemPosition.left + elemWidth / 2) - this._tooltipWidth / 2 + 'px';
                }
                if (this.placement == 'left') {
                    this._tooltipElement.style.left = elemPosition.left - this._tooltipWidth - this.tooltipOffset + 'px';
                }
                if (this.placement == 'right') {
                    this._tooltipElement.style.left = elemPosition.left + elemWidth + this.tooltipOffset + 'px';
                }
                if (this.placement == 'left' || this.placement == 'right') {
                    this._tooltipElement.style.top = elemPosition.top + elemHeight / 2 - this._tooltipElement.clientHeight / 2 + 'px';
                }
                // correct left positioning of tooltip if outside the screen
                var offsetLeft = parseInt(this._tooltipElement.style.left);
                if (offsetLeft < 0) {
                    this._tooltipElement.style.left = 0 + 'px';
                }
            }
        }
        else {
            this._updateTooltipElement();
        }
    };
    KTooltipDirective.prototype.ngOnDestroy = function () {
        this._removeTooltipElement();
    };
    KTooltipDirective.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], KTooltipDirective.prototype, "tooltipResolver", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Boolean)
    ], KTooltipDirective.prototype, "escape", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], KTooltipDirective.prototype, "tooltipOffset", void 0);
    __decorate([
        Input(),
        __metadata("design:type", String)
    ], KTooltipDirective.prototype, "placement", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], KTooltipDirective.prototype, "delay", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Number)
    ], KTooltipDirective.prototype, "maxWidth", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], KTooltipDirective.prototype, "followTarget", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], KTooltipDirective.prototype, "showOnEllipsis", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object),
        __metadata("design:paramtypes", [Object])
    ], KTooltipDirective.prototype, "kTooltip", null);
    __decorate([
        HostListener("mousemove"),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", []),
        __metadata("design:returntype", void 0)
    ], KTooltipDirective.prototype, "onMouseMove", null);
    __decorate([
        HostListener("mouseenter"),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", []),
        __metadata("design:returntype", void 0)
    ], KTooltipDirective.prototype, "onMouseEnter", null);
    __decorate([
        HostListener("mouseleave"),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", []),
        __metadata("design:returntype", void 0)
    ], KTooltipDirective.prototype, "onMouseLeave", null);
    KTooltipDirective = __decorate([
        Directive({
            selector: '[kTooltip]'
        }),
        __metadata("design:paramtypes", [ElementRef])
    ], KTooltipDirective);
    return KTooltipDirective;
}());
export { KTooltipDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiay10b29sdGlwLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BrYWx0dXJhLW5nL2thbHR1cmEtdWkvIiwic291cmNlcyI6WyJsaWIvdG9vbHRpcC9rLXRvb2x0aXAuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQU90RjtJQUVJLDJCQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBR2xDLG9CQUFlLEdBQWdCLElBQUksQ0FBQztRQUNwQyxvQkFBZSxHQUFRLElBQUksQ0FBQztRQUM1QixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsbUJBQWMsR0FBVyxJQUFJLENBQUM7UUFDOUIsa0JBQWEsR0FBVyxJQUFJLENBQUM7UUFFNUIsb0JBQWUsR0FBb0MsSUFBSSxDQUFDO1FBQ3hELFdBQU0sR0FBWSxJQUFJLENBQUM7UUFDdkIsa0JBQWEsR0FBVyxDQUFDLENBQUM7UUFDMUIsY0FBUyxHQUFxQixLQUFLLENBQUM7UUFDcEMsVUFBSyxHQUFHLEdBQUcsQ0FBQztRQUNaLGFBQVEsR0FBVyxHQUFHLENBQUM7UUFDdkIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDckIsbUJBQWMsR0FBRyxLQUFLLENBQUM7SUFmaEMsQ0FBQztJQWtCRCxzQkFBSSx1Q0FBUTthQUFaLFVBQWEsS0FBVTtZQUNuQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzVCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFDO2FBQ2hDO2lCQUNJO2dCQUNELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO2FBQy9CO1lBRUQsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDakMsQ0FBQzs7O09BQUE7SUFFTywwQ0FBYyxHQUF0QixVQUF1QixLQUFV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LElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO2lCQUM1QzthQUNKO1NBQ0o7YUFDUDtZQUNDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1NBQzdCO0lBQ0MsQ0FBQztJQUVELHVDQUFXLEdBQVg7UUFDSSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztJQUNqQyxDQUFDOztnQkEzTStCLFVBQVU7O0lBU2pDO1FBQVIsS0FBSyxFQUFFOzs4REFBeUQ7SUFDeEQ7UUFBUixLQUFLLEVBQUU7O3FEQUF3QjtJQUN2QjtRQUFSLEtBQUssRUFBRTs7NERBQTJCO0lBQzFCO1FBQVIsS0FBSyxFQUFFOzt3REFBcUM7SUFDcEM7UUFBUixLQUFLLEVBQUU7O29EQUFhO0lBQ1o7UUFBUixLQUFLLEVBQUU7O3VEQUF3QjtJQUN2QjtRQUFSLEtBQUssRUFBRTs7MkRBQXNCO0lBQ3JCO1FBQVIsS0FBSyxFQUFFOzs2REFBd0I7SUFHaEM7UUFEQyxLQUFLLEVBQUU7OztxREFVUDtJQW1ERDtRQURDLFlBQVksQ0FBQyxXQUFXLENBQUM7Ozs7d0RBS3pCO0lBR0Q7UUFEQyxZQUFZLENBQUMsWUFBWSxDQUFDOzs7O3lEQU0xQjtJQUdEO1FBREMsWUFBWSxDQUFDLFlBQVksQ0FBQzs7Ozt5REFJMUI7SUFuR1EsaUJBQWlCO1FBSDdCLFNBQVMsQ0FBQztZQUNWLFFBQVEsRUFBRSxZQUFZO1NBQ3RCLENBQUM7eUNBR2tDLFVBQVU7T0FGakMsaUJBQWlCLENBOE03QjtJQUFELHdCQUFDO0NBQUEsQUE5TUQsSUE4TUM7U0E5TVksaUJBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuZXhwb3J0IHR5cGUgVG9vbHRpcFBvc2l0aW9ucyA9ICd0b3AnIHwgJ2xlZnQnIHwgJ3JpZ2h0JyB8ICdib3R0b20nO1xuXG5ARGlyZWN0aXZlKHtcblx0c2VsZWN0b3I6ICdba1Rvb2x0aXBdJ1xufSlcbmV4cG9ydCBjbGFzcyBLVG9vbHRpcERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcbiAgICB9XG5cbiAgICBwcml2YXRlIF90b29sdGlwRWxlbWVudDogSFRNTEVsZW1lbnQgPSBudWxsO1xuICAgIHByaXZhdGUgX3Rvb2x0aXBDb250ZW50OiBhbnkgPSBudWxsO1xuICAgIHByaXZhdGUgX3Nob3VsZEJlVmlzaWJsZSA9IGZhbHNlO1xuICAgIHByaXZhdGUgX3Rvb2x0aXBIZWlnaHQ6IG51bWJlciA9IG51bGw7XG4gICAgcHJpdmF0ZSBfdG9vbHRpcFdpZHRoOiBudW1iZXIgPSBudWxsO1xuXG4gICAgQElucHV0KCkgdG9vbHRpcFJlc29sdmVyOiBzdHJpbmcgfCAoKHZhbDogYW55KSA9PiBzdHJpbmcpID0gbnVsbDtcbiAgICBASW5wdXQoKSBlc2NhcGU6IGJvb2xlYW4gPSB0cnVlO1xuICAgIEBJbnB1dCgpIHRvb2x0aXBPZmZzZXQ6IG51bWJlciA9IDg7XG4gICAgQElucHV0KCkgcGxhY2VtZW50OiBUb29sdGlwUG9zaXRpb25zID0gXCJ0b3BcIjtcbiAgICBASW5wdXQoKSBkZWxheSA9IDMwMDtcbiAgICBASW5wdXQoKSBtYXhXaWR0aDogbnVtYmVyID0gMzAwO1xuICAgIEBJbnB1dCgpIGZvbGxvd1RhcmdldCA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHNob3dPbkVsbGlwc2lzID0gZmFsc2U7XG5cbiAgICBASW5wdXQoKVxuICAgIHNldCBrVG9vbHRpcCh2YWx1ZTogYW55KSB7XG4gICAgICAgIGlmICh0aGlzLmlzVmFsaWRDb250ZW50KHZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy5fdG9vbHRpcENvbnRlbnQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBDb250ZW50ID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3VwZGF0ZVRvb2x0aXBFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpc1ZhbGlkQ29udGVudCh2YWx1ZTogYW55KVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdmFsdWUgIT09ICcnICYmIHZhbHVlICE9PSBudWxsO1xuICAgIH1cblxuICAgIHByaXZhdGUgX3VwZGF0ZVRvb2x0aXBFbGVtZW50KCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuX3Rvb2x0aXBDb250ZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faXNTaG93aW5nVG9vbHRpcCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlVG9vbHRpcEVsZW1lbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9zaG91bGRCZVZpc2libGUpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5faXNTaG93aW5nVG9vbHRpcCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcbiAgICAgICAgICAgICAgICB0aGlzLl90b29sdGlwRWxlbWVudC5jbGFzc05hbWUgKz0gXCJuZy10b29sdGlwIG5nLXRvb2x0aXAtXCIgKyB0aGlzLnBsYWNlbWVudDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXhXaWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuc3R5bGUubWF4V2lkdGggPSB0aGlzLm1heFdpZHRoICsgXCJweFwiO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGFkZFRvb2x0aXBWaXNpYmxlQ2xhc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90b29sdGlwRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuY2xhc3NOYW1lICs9IFwiIG5nLXRvb2x0aXAtc2hvd1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlbGF5KSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYWRkVG9vbHRpcFZpc2libGVDbGFzcywgdGhpcy5kZWxheSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkVG9vbHRpcFZpc2libGVDbGFzcygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5fdG9vbHRpcEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGVUb29sdGlwRWxlbWVudENvbnRlbnQoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVUb29sdGlwRWxlbWVudFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91cGRhdGVUb29sdGlwRWxlbWVudENvbnRlbnQoKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVUb29sdGlwRWxlbWVudFBvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2lzU2hvd2luZ1Rvb2x0aXAoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVRvb2x0aXBFbGVtZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKFwibW91c2Vtb3ZlXCIpXG4gICAgb25Nb3VzZU1vdmUoKSB7XG4gICAgICAgIGlmICh0aGlzLmZvbGxvd1RhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlVG9vbHRpcEVsZW1lbnRQb3NpdGlvbigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgQEhvc3RMaXN0ZW5lcihcIm1vdXNlZW50ZXJcIilcbiAgICBvbk1vdXNlRW50ZXIoKSB7XG4gICAgICBpZiAoIXRoaXMuc2hvd09uRWxsaXBzaXMgfHwgdGhpcy5pc0luRWxsaXBzaXMoKSkge1xuICAgICAgICB0aGlzLl9zaG91bGRCZVZpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLl91cGRhdGVUb29sdGlwRWxlbWVudCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIpXG4gICAgb25Nb3VzZUxlYXZlKCkge1xuICAgICAgICB0aGlzLl9zaG91bGRCZVZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdXBkYXRlVG9vbHRpcEVsZW1lbnQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzSW5FbGxpcHNpcygpOiBib29sZWFuIHtcbiAgICAgIC8vIGFkZGVkIHRoZSAtMSB0aHJlc2hvbGQgdG8gc3VwcG9ydCBJRSBhbmQgZWRnZSB3aGljaCBhbHdheXMgc2hvdyBhIDFweCBkaWZmZXJlbmNlIGJldHdlZW4gb2Zmc2V0V2lkdGggYW5kIHNjcm9sbFdpZHRoXG4gICAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggPCAodGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGggLSAxKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZW1vdmVUb29sdGlwRWxlbWVudCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3Rvb2x0aXBFbGVtZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdG9vbHRpcEVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5fdG9vbHRpcEVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEhlaWdodCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl90b29sdGlwV2lkdGggPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaXNTaG93aW5nVG9vbHRpcCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Rvb2x0aXBFbGVtZW50ICE9PSBudWxsO1xuXHR9XG5cbiAgICBwcml2YXRlIF91cGRhdGVUb29sdGlwRWxlbWVudENvbnRlbnQoKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICh0aGlzLl9pc1Nob3dpbmdUb29sdGlwKCkgJiYgdGhpcy5fdG9vbHRpcENvbnRlbnQpIHtcblxuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSAnJztcblxuICAgICAgICAgICAgaWYgKHRoaXMudG9vbHRpcFJlc29sdmVyICYmIHR5cGVvZiB0aGlzLnRvb2x0aXBSZXNvbHZlciA9PT0gJ3N0cmluZycpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMuX3Rvb2x0aXBDb250ZW50W3RoaXMudG9vbHRpcFJlc29sdmVyXTtcbiAgICAgICAgICAgIH1lbHNlIGlmICh0aGlzLnRvb2x0aXBSZXNvbHZlciAmJiB0eXBlb2YgdGhpcy50b29sdGlwUmVzb2x2ZXIgPT09ICdmdW5jdGlvbicpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMudG9vbHRpcFJlc29sdmVyKHRoaXMuX3Rvb2x0aXBDb250ZW50KTtcbiAgICAgICAgICAgIH1lbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IHRoaXMuX3Rvb2x0aXBDb250ZW50O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc1ZhbGlkQ29udGVudChjb250ZW50KSkge1xuICAgICAgICAgICAgICAgIC8vIHJlLWNoZWNrIGNvbnRlbnQgdHlwZSB0byBoYW5kbGUgc2NlbmFyaW9zIHdoZW4gdGhlIHRvb2x0aXBSZXNvbHZlciBjYXVzZWQgdGhlIHZhbHVlIHRvIGJlIHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXNjYXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LnRleHRDb250ZW50ID0gY29udGVudDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90b29sdGlwRWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBIZWlnaHQgPSB0aGlzLl90b29sdGlwRWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcFdpZHRoID0gdGhpcy5fdG9vbHRpcEVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVRvb2x0aXBFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfdXBkYXRlVG9vbHRpcEVsZW1lbnRQb3NpdGlvbigpIHtcblxuICAgICAgICBpZiAodGhpcy5faXNTaG93aW5nVG9vbHRpcCgpKSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtUG9zaXRpb24gPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICAgICAgaWYgKGVsZW1Qb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGxldCBlbGVtSGVpZ2h0ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgICAgICAgIGxldCBlbGVtV2lkdGggPSB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PSAndG9wJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90b29sdGlwRWxlbWVudC5zdHlsZS50b3AgPSBlbGVtUG9zaXRpb24udG9wIC0gKHRoaXMuX3Rvb2x0aXBIZWlnaHQgKyB0aGlzLnRvb2x0aXBPZmZzZXQpICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuc3R5bGUudG9wID0gZWxlbVBvc2l0aW9uLnRvcCArIGVsZW1IZWlnaHQgKyB0aGlzLnRvb2x0aXBPZmZzZXQgKyAncHgnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PSAndG9wJyB8fCB0aGlzLnBsYWNlbWVudCA9PSAnYm90dG9tJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90b29sdGlwRWxlbWVudC5zdHlsZS5sZWZ0ID0gKGVsZW1Qb3NpdGlvbi5sZWZ0ICsgZWxlbVdpZHRoIC8gMikgLSB0aGlzLl90b29sdGlwV2lkdGggLyAyICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT0gJ2xlZnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSBlbGVtUG9zaXRpb24ubGVmdCAtIHRoaXMuX3Rvb2x0aXBXaWR0aCAtIHRoaXMudG9vbHRpcE9mZnNldCArICdweCc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuc3R5bGUubGVmdCA9IGVsZW1Qb3NpdGlvbi5sZWZ0ICsgZWxlbVdpZHRoICsgdGhpcy50b29sdGlwT2Zmc2V0ICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50ID09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG9vbHRpcEVsZW1lbnQuc3R5bGUudG9wID0gZWxlbVBvc2l0aW9uLnRvcCArIGVsZW1IZWlnaHQgLyAyIC0gdGhpcy5fdG9vbHRpcEVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gMiArICdweCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGNvcnJlY3QgbGVmdCBwb3NpdGlvbmluZyBvZiB0b29sdGlwIGlmIG91dHNpZGUgdGhlIHNjcmVlblxuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldExlZnQgPSBwYXJzZUludCh0aGlzLl90b29sdGlwRWxlbWVudC5zdHlsZS5sZWZ0KTtcbiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0TGVmdCA8IDApIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuX3Rvb2x0aXBFbGVtZW50LnN0eWxlLmxlZnQgPSAwICsgJ3B4JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1lbHNlXG5cdFx0e1xuXHRcdFx0dGhpcy5fdXBkYXRlVG9vbHRpcEVsZW1lbnQoKTtcblx0XHR9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX3JlbW92ZVRvb2x0aXBFbGVtZW50KCk7XG4gICAgfVxufVxuIl19