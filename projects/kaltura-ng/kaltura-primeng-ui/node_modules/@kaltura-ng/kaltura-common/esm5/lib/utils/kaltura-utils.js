import { __read, __spread } from "tslib";
import { Download } from './download';
var _xmlCharMap = {
    '<': '&lt;',
    '>': '&gt;',
    '&': '&amp;'
};
var KalturaUtils = /** @class */ (function () {
    function KalturaUtils() {
    }
    KalturaUtils.escapeXml = function (value) {
        var parsedValue = value;
        switch (typeof value) {
            case 'string':
            case 'number':
            case 'boolean':
                parsedValue = value;
                break;
            default:
                parsedValue = value || '';
                break;
        }
        return String(parsedValue).replace(/[&<>]/g, function (char) { return _xmlCharMap[char]; });
    };
    KalturaUtils.getStartDateValue = function (value) {
        if (value) {
            var newValue = new Date(value.getTime());
            newValue.setHours(0);
            newValue.setMinutes(0);
            newValue.setSeconds(0);
            return newValue;
        }
        else {
            return null;
        }
    };
    KalturaUtils.getEndDateValue = function (value) {
        if (value) {
            var newValue = new Date(value.getTime());
            newValue.setHours(23);
            newValue.setMinutes(59);
            newValue.setSeconds(59);
            return newValue;
        }
        else {
            return null;
        }
    };
    KalturaUtils.removeEmptyProperties = function (value) {
        Object.keys(value).forEach(function (key) {
            if (value[key] && typeof value[key] === 'object') {
                KalturaUtils.removeEmptyProperties(value[key]);
            }
            else if (value[key] === null) {
                delete value[key];
            }
        });
        return value;
    };
    KalturaUtils.moveUpItems = function (list, selectedItems) {
        if (list && list.length && selectedItems && selectedItems.length) {
            var relevantItems = selectedItems.map(function (item) { return ({ selectedItem: item, index: list.indexOf(item) }); })
                .filter(function (item) { return item.index !== -1; })
                .sort(function (a, b) { return a.index - b.index; });
            if (relevantItems.length) {
                var minIndexInSelected = relevantItems[0].index;
                var nextIndex = Math.max(0, minIndexInSelected - 1);
                relevantItems.forEach(function (item, i) {
                    list.splice(item.index - i, 1);
                });
                list.splice.apply(list, __spread([nextIndex, 0], relevantItems.map(function (item) { return item.selectedItem; })));
                return true;
            }
        }
        return false;
    };
    KalturaUtils.moveDownItems = function (list, selectedItems) {
        if (selectedItems && selectedItems.length && list && list.length) {
            var relevantItems = selectedItems.map(function (item) { return ({ selectedItem: item, index: list.indexOf(item) }); })
                .filter(function (item) { return item.index !== -1; })
                .sort(function (a, b) { return a.index - b.index; });
            if (relevantItems.length) {
                var maxIndexInSelected = relevantItems[relevantItems.length - 1].index;
                var nextIndex = Math.min(list.length - 1, maxIndexInSelected + 1);
                relevantItems.forEach(function (item, i) {
                    list.splice(item.index - i, 1);
                });
                var correctedIndex = nextIndex - relevantItems.length;
                list.splice.apply(list, __spread([correctedIndex + 1, 0], relevantItems.map(function (item) { return item.selectedItem; })));
                return true;
            }
        }
        return false;
    };
    KalturaUtils.formatTime = function (value, addTimeChars) {
        if (addTimeChars === void 0) { addTimeChars = false; }
        var hours = Math.floor(Math.round(value) / 3600) % 24;
        var minutes = Math.floor((Math.round(value) / 60) % 60);
        var seconds = Math.round(value) % 60;
        var hoursStr = hours === 0 ? '' : addTimeChars ? hours.toString() + "h:" : hours.toString() + ":";
        var minutesStr = minutes === 0 && hours === 0 ? '00' : minutes < 10 ? '0' + minutes.toString() : minutes.toString();
        var secondsStr = seconds < 10 ? '0' + seconds.toString() : seconds.toString();
        if (addTimeChars) {
            minutesStr = minutesStr + "m";
            secondsStr = secondsStr + "s";
        }
        return hoursStr + minutesStr + ":" + secondsStr;
    };
    KalturaUtils.fromServerDate = function (value) {
        return (value ? new Date(value * 1000) : null);
    };
    KalturaUtils.toServerDate = function (value) {
        return value ? Math.round(value.getTime() / 1000) : null;
    };
    KalturaUtils.download = function (data, strFileName, strMimeType) {
        return Download(data, strFileName, strMimeType);
    };
    return KalturaUtils;
}());
export { KalturaUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2FsdHVyYS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BrYWx0dXJhLW5nL2thbHR1cmEtY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3V0aWxzL2thbHR1cmEtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdEMsSUFBTSxXQUFXLEdBQUc7SUFDaEIsR0FBRyxFQUFFLE1BQU07SUFDWCxHQUFHLEVBQUUsTUFBTTtJQUNYLEdBQUcsRUFBRSxPQUFPO0NBQ2YsQ0FBQztBQUVGO0lBQUE7SUFpSUEsQ0FBQztJQS9IVSxzQkFBUyxHQUFoQixVQUFpQixLQUFVO1FBQ3ZCLElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQztRQUN4QixRQUFPLE9BQU8sS0FBSyxFQUNuQjtZQUNJLEtBQUssUUFBUSxDQUFDO1lBQ2QsS0FBSyxRQUFRLENBQUM7WUFDZCxLQUFLLFNBQVM7Z0JBQ1YsV0FBVyxHQUFHLEtBQUssQ0FBQztnQkFDcEIsTUFBTTtZQUNWO2dCQUNBLFdBQVcsR0FBRyxLQUFLLElBQUksRUFBRSxDQUFDO2dCQUN0QixNQUFNO1NBQ2I7UUFFRCxPQUFPLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFVBQUEsSUFBSSxJQUFJLE9BQUEsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFqQixDQUFpQixDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVHLDhCQUFpQixHQUF4QixVQUF5QixLQUFZO1FBRTlCLElBQUksS0FBSyxFQUFFO1lBQ1AsSUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDM0MsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQixRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxD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UUFDdkYsSUFBSSxZQUFZLEVBQUM7WUFDYixVQUFVLEdBQUcsVUFBVSxHQUFHLEdBQUcsQ0FBQztZQUM5QixVQUFVLEdBQUcsVUFBVSxHQUFHLEdBQUcsQ0FBQztTQUNqQztRQUNELE9BQU8sUUFBUSxHQUFHLFVBQVUsR0FBRyxHQUFHLEdBQUcsVUFBVSxDQUFDO0lBQ3BELENBQUM7SUFFTSwyQkFBYyxHQUFyQixVQUFzQixLQUFjO1FBRWhDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVNLHlCQUFZLEdBQW5CLFVBQW9CLEtBQVk7UUFFNUIsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDN0QsQ0FBQztJQUVNLHFCQUFRLEdBQWYsVUFBZ0IsSUFBUyxFQUFFLFdBQW1CLEVBQUUsV0FBbUI7UUFFL0QsT0FBTyxRQUFRLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBQ0wsbUJBQUM7QUFBRCxDQUFDLEFBaklELElBaUlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRG93bmxvYWQgfSBmcm9tICcuL2Rvd25sb2FkJztcblxuY29uc3QgX3htbENoYXJNYXAgPSB7XG4gICAgJzwnOiAnJmx0OycsXG4gICAgJz4nOiAnJmd0OycsXG4gICAgJyYnOiAnJmFtcDsnXG59O1xuXG5leHBvcnQgY2xhc3MgS2FsdHVyYVV0aWxzXG57XG4gICAgc3RhdGljIGVzY2FwZVhtbCh2YWx1ZTogYW55KSA6IHN0cmluZyB7XG4gICAgICAgIGxldCBwYXJzZWRWYWx1ZSA9IHZhbHVlO1xuICAgICAgICBzd2l0Y2godHlwZW9mIHZhbHVlKVxuICAgICAgICB7XG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgIHBhcnNlZFZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcGFyc2VkVmFsdWUgPSB2YWx1ZSB8fCAnJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBTdHJpbmcocGFyc2VkVmFsdWUpLnJlcGxhY2UoL1smPD5dL2csIGNoYXIgPT4gX3htbENoYXJNYXBbY2hhcl0pO1xuICAgIH1cblxuXHRzdGF0aWMgZ2V0U3RhcnREYXRlVmFsdWUodmFsdWUgOiBEYXRlKSA6IERhdGVcbiAgICB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBuZXcgRGF0ZSh2YWx1ZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgbmV3VmFsdWUuc2V0SG91cnMoMCk7XG4gICAgICAgICAgICBuZXdWYWx1ZS5zZXRNaW51dGVzKDApO1xuICAgICAgICAgICAgbmV3VmFsdWUuc2V0U2Vjb25kcygwKTtcbiAgICAgICAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRFbmREYXRlVmFsdWUodmFsdWUgOiBEYXRlKSA6IERhdGVcbiAgICB7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBuZXcgRGF0ZSh2YWx1ZS5nZXRUaW1lKCkpO1xuICAgICAgICAgICAgbmV3VmFsdWUuc2V0SG91cnMoMjMpO1xuICAgICAgICAgICAgbmV3VmFsdWUuc2V0TWludXRlcyg1OSk7XG4gICAgICAgICAgICBuZXdWYWx1ZS5zZXRTZWNvbmRzKDU5KTtcbiAgICAgICAgICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1zdGF0aWMgcmVtb3ZlRW1wdHlQcm9wZXJ0aWVzKHZhbHVlIDoge30pXG5cdHtcblx0XHRPYmplY3Qua2V5cyh2YWx1ZSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRcdGlmICh2YWx1ZVtrZXldICYmIHR5cGVvZiB2YWx1ZVtrZXldID09PSAnb2JqZWN0Jykge1xuXHRcdFx0XHRLYWx0dXJhVXRpbHMucmVtb3ZlRW1wdHlQcm9wZXJ0aWVzKHZhbHVlW2tleV0pO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiAodmFsdWVba2V5XSA9PT0gbnVsbCkge1xuXHRcdFx0XHRkZWxldGUgdmFsdWVba2V5XVxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHJldHVybiB2YWx1ZTtcblx0fVxuXG4gICAgc3RhdGljIG1vdmVVcEl0ZW1zPFQ+KGxpc3Q6IFRbXSwgc2VsZWN0ZWRJdGVtcyA6IFRbXSk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAobGlzdCAmJiBsaXN0Lmxlbmd0aCAmJiBzZWxlY3RlZEl0ZW1zICYmIHNlbGVjdGVkSXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZWxldmFudEl0ZW1zID0gc2VsZWN0ZWRJdGVtcy5tYXAoaXRlbSA9PiAoeyBzZWxlY3RlZEl0ZW06IGl0ZW0sIGluZGV4OiBsaXN0LmluZGV4T2YoaXRlbSkgfSkpXG4gICAgICAgICAgICAgICAgLmZpbHRlcihpdGVtID0+IGl0ZW0uaW5kZXggIT09IC0xKVxuICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7XG4gICAgICAgICAgICBpZiAocmVsZXZhbnRJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW5JbmRleEluU2VsZWN0ZWQgPSByZWxldmFudEl0ZW1zWzBdLmluZGV4O1xuICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IE1hdGgubWF4KDAsIG1pbkluZGV4SW5TZWxlY3RlZCAtIDEpO1xuICAgICAgICAgICAgICAgIHJlbGV2YW50SXRlbXMuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnNwbGljZShpdGVtLmluZGV4IC0gaSwgMSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsaXN0LnNwbGljZShuZXh0SW5kZXgsIDAsIC4uLnJlbGV2YW50SXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZEl0ZW0pKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHN0YXRpYyBtb3ZlRG93bkl0ZW1zPFQ+KGxpc3Q6IFRbXSwgc2VsZWN0ZWRJdGVtcyA6IFRbXSk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoc2VsZWN0ZWRJdGVtcyAmJiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCAmJiBsaXN0ICYmIGxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZWxldmFudEl0ZW1zID0gc2VsZWN0ZWRJdGVtcy5tYXAoaXRlbSA9PiAoeyBzZWxlY3RlZEl0ZW06IGl0ZW0sIGluZGV4OiBsaXN0LmluZGV4T2YoaXRlbSkgfSkpXG4gICAgICAgICAgICAgICAgLmZpbHRlcihpdGVtID0+IGl0ZW0uaW5kZXggIT09IC0xKVxuICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmluZGV4IC0gYi5pbmRleCk7XG4gICAgICAgICAgICBpZiAocmVsZXZhbnRJdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtYXhJbmRleEluU2VsZWN0ZWQgPSByZWxldmFudEl0ZW1zW3JlbGV2YW50SXRlbXMubGVuZ3RoIC0gMV0uaW5kZXg7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gTWF0aC5taW4obGlzdC5sZW5ndGggLSAxLCBtYXhJbmRleEluU2VsZWN0ZWQgKyAxKTtcbiAgICAgICAgICAgICAgICByZWxldmFudEl0ZW1zLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5zcGxpY2UoaXRlbS5pbmRleCAtIGksIDEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RlZEluZGV4ID0gbmV4dEluZGV4IC0gcmVsZXZhbnRJdGVtcy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBsaXN0LnNwbGljZShjb3JyZWN0ZWRJbmRleCArIDEsIDAsIC4uLnJlbGV2YW50SXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5zZWxlY3RlZEl0ZW0pKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHN0YXRpYyBmb3JtYXRUaW1lKHZhbHVlOiBudW1iZXIsIGFkZFRpbWVDaGFyczogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHtcblxuICAgICAgICBsZXQgaG91cnM6IG51bWJlciA9IE1hdGguZmxvb3IoIE1hdGgucm91bmQoIHZhbHVlICkgLyAzNjAwICkgJSAyNDtcbiAgICAgICAgbGV0IG1pbnV0ZXM6IG51bWJlciA9IE1hdGguZmxvb3IoICggTWF0aC5yb3VuZCggdmFsdWUgKSAvIDYwICkgJSA2MCApO1xuICAgICAgICBsZXQgc2Vjb25kczogbnVtYmVyID0gTWF0aC5yb3VuZCh2YWx1ZSkgJSA2MDtcblxuICAgICAgICBsZXQgaG91cnNTdHI6IHN0cmluZyA9IGhvdXJzID09PSAwID8gJycgOiBhZGRUaW1lQ2hhcnMgPyBob3Vycy50b1N0cmluZygpICsgXCJoOlwiIDogaG91cnMudG9TdHJpbmcoKSArIFwiOlwiO1xuICAgICAgICBsZXQgbWludXRlc1N0cjogc3RyaW5nID0gbWludXRlcyA9PT0gMCAmJiBob3VycyA9PT0gMCA/ICcwMCcgOiBtaW51dGVzIDwgMTAgID8gJzAnICsgbWludXRlcy50b1N0cmluZygpIDogbWludXRlcy50b1N0cmluZygpO1xuICAgICAgICBsZXQgc2Vjb25kc1N0cjogc3RyaW5nID0gc2Vjb25kcyA8IDEwICA/ICcwJyArIHNlY29uZHMudG9TdHJpbmcoKSA6IHNlY29uZHMudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKGFkZFRpbWVDaGFycyl7XG4gICAgICAgICAgICBtaW51dGVzU3RyID0gbWludXRlc1N0ciArIFwibVwiO1xuICAgICAgICAgICAgc2Vjb25kc1N0ciA9IHNlY29uZHNTdHIgKyBcInNcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaG91cnNTdHIgKyBtaW51dGVzU3RyICsgXCI6XCIgKyBzZWNvbmRzU3RyO1xuICAgIH1cblxuICAgIHN0YXRpYyBmcm9tU2VydmVyRGF0ZSh2YWx1ZSA6IG51bWJlcikgOiBEYXRlXG4gICAge1xuICAgICAgICByZXR1cm4gKHZhbHVlID8gbmV3IERhdGUodmFsdWUgKiAxMDAwKSA6IG51bGwpO1xuICAgIH1cblxuICAgIHN0YXRpYyB0b1NlcnZlckRhdGUodmFsdWUgOiBEYXRlKSA6IG51bWJlclxuICAgIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gTWF0aC5yb3VuZCh2YWx1ZS5nZXRUaW1lKCkgLyAxMDAwKSA6IG51bGw7XG4gICAgfVxuXG4gICAgc3RhdGljIGRvd25sb2FkKGRhdGE6IGFueSwgc3RyRmlsZU5hbWU6IHN0cmluZywgc3RyTWltZVR5cGU6IHN0cmluZykgOiBCb29sZWFuXG4gICAge1xuICAgICAgICByZXR1cm4gRG93bmxvYWQoZGF0YSwgc3RyRmlsZU5hbWUsIHN0ck1pbWVUeXBlKTtcbiAgICB9XG59XG4iXX0=